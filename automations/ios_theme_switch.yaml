# ==============================================
# ë‚ ì”¨ & ì¼ì • ê¸°ë°˜ ìë™í™”
# ==============================================

# ì˜¨ë„ ê¸°ë°˜ ì—ì–´ì»¨ ìë™ ì œì–´
- id: smart_ac_temperature_control
  alias: "ìŠ¤ë§ˆíŠ¸ ì—ì–´ì»¨ ì˜¨ë„ ì œì–´"
  description: "ì‹¤ë‚´ ì˜¨ë„ì— ë”°ë¼ ì—ì–´ì»¨ ìë™ ì¡°ì ˆ"
  trigger:
    - platform: numeric_state
      entity_id: sensor.seutaendeuhyeong_eeokeon_temperature
      above: 28  # 28ë„ ì´ìƒ
      for: "00:10:00"  # 10ë¶„ê°„ ì§€ì†
    - platform: numeric_state
      entity_id: sensor.seutaendeuhyeong_eeokeon_temperature
      below: 22  # 22ë„ ì´í•˜
      for: "00:10:00"  # 10ë¶„ê°„ ì§€ì†
  condition:
    - condition: state
      entity_id: binary_sensor.someone_home
      state: "on"
    - condition: state
      entity_id: binary_sensor.workday_sensor
      state: "on"  # ê·¼ë¬´ì¼ì—ë§Œ
  action:
    - choose:
        - conditions:
            - condition: numeric_state
              entity_id: sensor.seutaendeuhyeong_eeokeon_temperature
              above: 28
          sequence:
            - service: climate.set_temperature
              target:
                entity_id: climate.seutaendeuhyeong_eeokeon
              data:
                temperature: 24
                hvac_mode: "cool"
            - service: persistent_notification.create
              data:
                title: "â„ï¸ ì—ì–´ì»¨ ëƒ‰ë°© ìë™ ì‹œì‘"
                message: "ì‹¤ë‚´ ì˜¨ë„ê°€ {{ states('sensor.seutaendeuhyeong_eeokeon_temperature') }}Â°Cë¡œ ë†’ì•„ì ¸ì„œ ëƒ‰ë°©ì„ ì‹œì‘í–ˆìŠµë‹ˆë‹¤."
        - conditions:
            - condition: numeric_state
              entity_id: sensor.seutaendeuhyeong_eeokeon_temperature
              below: 22
          sequence:
            - service: climate.turn_off
              target:
                entity_id: climate.seutaendeuhyeong_eeokeon
            - service: persistent_notification.create
              data:
                title: "ğŸŒ¡ï¸ ì—ì–´ì»¨ ìë™ ì •ì§€"
                message: "ì‹¤ë‚´ ì˜¨ë„ê°€ {{ states('sensor.seutaendeuhyeong_eeokeon_temperature') }}Â°Cë¡œ ì ì •í•´ì ¸ì„œ ì—ì–´ì»¨ì„ ê»ìŠµë‹ˆë‹¤."

# ìŠµë„ ê´€ë¦¬ ì•Œë¦¼
- id: humidity_management_alert
  alias: "ìŠµë„ ê´€ë¦¬ ì•Œë¦¼"
  description: "ìŠµë„ê°€ ë„ˆë¬´ ë†’ê±°ë‚˜ ë‚®ì„ ë•Œ ì•Œë¦¼"
  trigger:
    - platform: numeric_state
      entity_id: sensor.seutaendeuhyeong_eeokeon_humidity
      above: 70  # 70% ì´ìƒ
      for: "00:30:00"
    - platform: numeric_state
      entity_id: sensor.seutaendeuhyeong_eeokeon_humidity
      below: 30  # 30% ì´í•˜
      for: "00:30:00"
  action:
    - service: persistent_notification.create
      data:
        title: "ğŸ’§ ìŠµë„ ê´€ë¦¬ í•„ìš”"
        message: >
          í˜„ì¬ ìŠµë„ê°€ {{ states('sensor.seutaendeuhyeong_eeokeon_humidity') }}%ì…ë‹ˆë‹¤.
          {% if trigger.above is defined %}
          ìŠµë„ê°€ ë†’ìŠµë‹ˆë‹¤. ì œìŠµì„ ê³ ë ¤í•´ë³´ì„¸ìš”.
          {% else %}
          ìŠµë„ê°€ ë‚®ìŠµë‹ˆë‹¤. ê°€ìŠµì„ ê³ ë ¤í•´ë³´ì„¸ìš”.
          {% endif %}
        notification_id: humidity_alert

# ==============================================
# ì‹œê°„ ê¸°ë°˜ ìë™í™”
# ==============================================

# ì¼ì¶œ ì‹œê°„ ì¡°ëª… ì„œì„œíˆ ì¼œê¸°
- id: sunrise_gradual_lighting
  alias: "ì¼ì¶œ ì¡°ëª… ì„œì„œíˆ ì¼œê¸°"
  description: "ì¼ì¶œ 30ë¶„ ì „ë¶€í„° ì¡°ëª…ì„ ì„œì„œíˆ ì¼œì„œ ìì—°ìŠ¤ëŸ¬ìš´ ê¸°ìƒ ìœ ë„"
  trigger:
    - platform: sun
      event: sunrise
      offset: "-00:30:00"  # ì¼ì¶œ 30ë¶„ ì „
  condition:
    - condition: state
      entity_id: binary_sensor.someone_home
      state: "on"
    - condition: state
      entity_id: binary_sensor.workday_sensor
      state: "on"  # ê·¼ë¬´ì¼ì—ë§Œ
  action:
    - service: light.turn_on
      target:
        entity_id: light.zigbee_dimmer
      data:
        brightness_pct: 10
        transition: 300  # 5ë¶„ì— ê±¸ì³ ì„œì„œíˆ
    - delay: "00:15:00"  # 15ë¶„ í›„
    - service: light.turn_on
      target:
        entity_id: light.zigbee_dimmer
      data:
        brightness_pct: 50
        transition: 900  # 15ë¶„ì— ê±¸ì³ ì„œì„œíˆ

# ì¼ëª° í›„ ìë™ ì¡°ëª… ì¼œê¸°
- id: sunset_auto_lighting
  alias: "ì¼ëª° í›„ ìë™ ì¡°ëª…"
  description: "ì¼ëª° í›„ ì§‘ì— ì‚¬ëŒì´ ìˆìœ¼ë©´ ìë™ìœ¼ë¡œ ì¡°ëª… ì¼œê¸°"
  trigger:
    - platform: sun
      event: sunset
      offset: "00:30:00"  # ì¼ëª° 30ë¶„ í›„
  condition:
    - condition: state
      entity_id: binary_sensor.someone_home
      state: "on"
  action:
    - service: light.turn_on
      target:
        entity_id:
          - light.zigbee_dimmer
          - light.smart_bulb
      data:
        brightness_pct: 80
        color_temp: 400  # ë”°ëœ»í•œ ìƒ‰ì˜¨ë„

# ì·¨ì¹¨ ì‹œê°„ ì¡°ëª… ìë™ ë„ê¸°
- id: bedtime_lights_off
  alias: "ì·¨ì¹¨ ì‹œê°„ ì¡°ëª… ë„ê¸°"
  description: "ì·¨ì¹¨ ì‹œê°„ì— ì¡°ëª… ìë™ìœ¼ë¡œ ë„ê¸°"
  trigger:
    - platform: time
      at: "23:30:00"  # ë°¤ 11ì‹œ 30ë¶„
  condition:
    - condition: state
      entity_id: binary_sensor.someone_home
      state: "on"
  action:
    # ì¡°ëª…ì„ ì„œì„œíˆ ì–´ë‘¡ê²Œ
    - service: light.turn_on
      target:
        entity_id:
          - light.zigbee_dimmer
          - light.smart_bulb
      data:
        brightness_pct: 20
        transition: 300  # 5ë¶„ì— ê±¸ì³
    - delay: "00:05:00"
    # ì™„ì „íˆ ë„ê¸°
    - service: light.turn_off
      target:
        entity_id:
          - light.zigbee_dimmer
          - light.smart_bulb
    - service: persistent_notification.create
      data:
        title: "ğŸŒ™ ì¢‹ì€ ê¿ˆ ë˜ì„¸ìš”"
        message: "ì·¨ì¹¨ ì‹œê°„ì´ë¼ ì¡°ëª…ì„ ê»ìŠµë‹ˆë‹¤. ì¢‹ì€ ë°¤ ë³´ë‚´ì„¸ìš”!"
        notification_id: bedtime_lights

# ê·¼ë¬´ì¼ ì•„ì¹¨ ì •ë³´ ë¸Œë¦¬í•‘
- id: workday_morning_briefing
  alias: "ê·¼ë¬´ì¼ ì•„ì¹¨ ë¸Œë¦¬í•‘"
  description: "ê·¼ë¬´ì¼ ì•„ì¹¨ì— ì˜¤ëŠ˜ì˜ ì •ë³´ ìš”ì•½ ì œê³µ"
  trigger:
    - platform: time
      at: "07:30:00"  # ì•„ì¹¨ 7ì‹œ 30ë¶„
  condition:
    - condition: state
      entity_id: binary_sensor.workday_sensor
      state: "on"
    - condition: state
      entity_id: binary_sensor.someone_home
      state: "on"
  action:
    - service: persistent_notification.create
      data:
        title: "â˜€ï¸ ì¢‹ì€ ì•„ì¹¨ì…ë‹ˆë‹¤!"
        message: >
          ì˜¤ëŠ˜ì˜ ì •ë³´ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”:
          
          ğŸ“… {{ states('sensor.date') }}
          ğŸŒ¡ï¸ ì‹¤ë‚´ ì˜¨ë„: {{ states('sensor.seutaendeuhyeong_eeokeon_temperature') }}Â°C
          ğŸ’§ ì‹¤ë‚´ ìŠµë„: {{ states('sensor.seutaendeuhyeong_eeokeon_humidity') }}%
          âš¡ í˜„ì¬ ì „ë ¥: {{ states('sensor.total_power_consumption') }}W
          ğŸ”‹ í‰ê·  ë°°í„°ë¦¬: {{ states('sensor.average_device_battery') }}%
          
          ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”! ğŸ’ª
        notification_id: morning_briefing

# ==============================================
# ì£¼ë§/íœ´ì¼ íŠ¹ë³„ ëª¨ë“œ
# ==============================================

# ì£¼ë§ ëŠ¦ì  ëª¨ë“œ
- id: weekend_sleep_mode
  alias: "ì£¼ë§ ëŠ¦ì  ëª¨ë“œ"
  description: "ì£¼ë§ì—ëŠ” ì¡°ëª…ì„ ëŠ¦ê²Œ ì¼œì„œ ëŠ¦ì  ë°°ë ¤"
  trigger:
    - platform: sun
      event: sunrise
      offset: "02:00:00"  # ì¼ì¶œ 2ì‹œê°„ í›„
  condition:
    - condition: state
      entity_id: binary_sensor.workday_sensor
      state: "off"  # íœ´ì¼
    - condition: state
      entity_id: binary_sensor.someone_home
      state: "on"
  action:
    - service: light.turn_on
      target:
        entity_id: light.zigbee_dimmer
      data:
        brightness_pct: 30  # ë” ì–´ë‘¡ê²Œ
        transition: 600    # 10ë¶„ì— ê±¸ì³ ì²œì²œíˆ
    - service: persistent_notification.create
      data:
        title: "ğŸ˜´ ì£¼ë§ ëª¨ë“œ"
        message: "ì£¼ë§ì´ë‹ˆê¹Œ ì²œì²œíˆ ì¼ì–´ë‚˜ì„¸ìš”. ì¡°ëª…ì„ ë¶€ë“œëŸ½ê²Œ ì¼°ìŠµë‹ˆë‹¤."
        notification_id: weekend_mode

# ì‹œìŠ¤í…œ ìƒíƒœ ì£¼ê°„ ë¦¬í¬íŠ¸
- id: weekly_system_report
  alias: "ì£¼ê°„ ì‹œìŠ¤í…œ ë¦¬í¬íŠ¸"
  description: "ë§¤ì£¼ ì¼ìš”ì¼ ì €ë…ì— ì‹œìŠ¤í…œ ìƒíƒœ ìš”ì•½ ë³´ê³ "
  trigger:
    - platform: time
      at: "20:00:00"  # ì €ë… 8ì‹œ
  condition:
    - condition: time
      weekday:
        - sun  # ì¼ìš”ì¼
  action:
    - service: persistent_notification.create
      data:
        title: "ğŸ“Š ì£¼ê°„ ì‹œìŠ¤í…œ ë¦¬í¬íŠ¸"
        message: >
          ì´ë²ˆ ì£¼ ì‹œìŠ¤í…œ ìƒíƒœ ìš”ì•½:
          
          ğŸ  ì‹œìŠ¤í…œ ê°€ë™ì‹œê°„: {{ states('sensor.last_boot') }}
          ğŸ’» í‰ê·  CPU ì‚¬ìš©ë¥ : {{ states('sensor.processor_use') }}%
          ğŸ’¾ ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ : {{ states('sensor.memory_use_percent') }}%
          ğŸ’½ ë””ìŠ¤í¬ ì‚¬ìš©ë¥ : {{ states('sensor.disk_use_percent') }}%
          ğŸŒ ë„¤íŠ¸ì›Œí¬ ì—°ê²° ê¸°ê¸°: {{ states('sensor.192_168_1_1_devices_connected') }}ê°œ
          
          ëª¨ë“  ì‹œìŠ¤í…œì´ ì •ìƒ ì‘ë™ ì¤‘ì…ë‹ˆë‹¤! ğŸ‘
        notification_id: weekly_report

# ==============================================
# iOS í…Œë§ˆ ìë™ ë³€ê²½ (ì›ë³¸ ê¸°ëŠ¥ ìœ ì§€)
# ==============================================

# iOS ë‹¤í¬ ëª¨ë“œ ìë™ ë³€ê²½ - ì¼ëª°ì‹œ
- id: ios_theme_dark_sunset
  alias: "iOS í…Œë§ˆ ë‹¤í¬ëª¨ë“œ (ì¼ëª°)"
  description: "ì¼ëª° ì‹œê°„ì— iOS ë‹¤í¬ í…Œë§ˆë¡œ ìë™ ë³€ê²½"
  trigger:
    - platform: sun
      event: sunset
      offset: "00:00:00"
  action:
    - service: frontend.set_theme
      data:
        name: "ios-dark-mode"

# iOS ë¼ì´íŠ¸ ëª¨ë“œ ìë™ ë³€ê²½ - ì¼ì¶œì‹œ
- id: ios_theme_light_sunrise
  alias: "iOS í…Œë§ˆ ë¼ì´íŠ¸ëª¨ë“œ (ì¼ì¶œ)"
  description: "ì¼ì¶œ ì‹œê°„ì— iOS ë¼ì´íŠ¸ í…Œë§ˆë¡œ ìë™ ë³€ê²½"
  trigger:
    - platform: sun
      event: sunrise
      offset: "00:00:00"
  action:
    - service: frontend.set_theme
      data:
        name: "ios-light-mode"