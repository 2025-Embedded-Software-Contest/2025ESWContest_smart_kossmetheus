- id: high_power_consumption_alert
  alias: 높은 전력 소비 알림
  description: 총 전력 소비가 임계값을 초과했을 때 알림
  triggers:
  - trigger: numeric_state
    entity_id: sensor.total_power_consumption
    above: 500
    for: 00:05:00
  conditions:
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
  actions:
  - action: persistent_notification.create
    data:
      title: ⚡ 전력 소비 주의
      message: '현재 전력 소비량이 {{ states(''sensor.total_power_consumption'') }}W입니다. 에너지
        절약을 위해 불필요한 기기를 확인해보세요.

        '
      notification_id: high_power_alert
- id: energy_saving_mode
  alias: 에너지 절약 모드
  description: 집에 아무도 없을 때 에너지 절약
  triggers:
  - trigger: state
    entity_id: binary_sensor.someone_home
    from: 'on'
    to: 'off'
    for: 00:30:00
  actions:
  - action: light.turn_off
    target:
      entity_id:
      - light.zigbee_dimmer
      - light.smart_bulb
  - action: persistent_notification.create
    data:
      title: "\U0001F3E0 에너지 절약 모드 활성화"
      message: 부재 중이므로 조명을 자동으로 꺼두었습니다.
- id: low_battery_device_alert
  alias: 저배터리 디바이스 알림
  triggers:
  - trigger: state
    entity_id: binary_sensor.low_battery_devices
    from: 'off'
    to: 'on'
  actions:
  - action: persistent_notification.create
    data:
      title: "\U0001F50B 배터리 부족 주의"
      message: "배터리가 부족한 디바이스가 있습니다: {% set devices = [\n  ('Apple Watch', states('sensor.gimuhyeonyi_apple_watch_battery')),\n
        \ ('MacBook Pro', states('sensor.gimuhyeonyi_macbook_pro_battery')),\n  ('iPad
        Pro', states('sensor.uhyeonyi_ipad_pro_battery')),\n  ('iPhone XS', states('sensor.uhyeonyi_iphone_xs_battery'))\n]
        %} {% for device, battery in devices %} {% if battery|int < 20 %} - {{ device
        }}: {{ battery }}% {% endif %} {% endfor %}\n"
      notification_id: low_battery_alert
- id: critical_battery_alert
  alias: 극저배터리 알림
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.gimuhyeonyi_apple_watch_battery
    - sensor.gimuhyeonyi_macbook_pro_battery
    - sensor.uhyeonyi_ipad_pro_battery
    - sensor.uhyeonyi_iphone_xs_battery
    below: 10
  actions:
  - action: persistent_notification.create
    data:
      title: "\U0001F6A8 배터리 위험 수준"
      message: '{{ trigger.to_state.attributes.friendly_name }}의 배터리가 {{ trigger.to_state.state
        }}%입니다. 즉시 충전하세요!

        '
      notification_id: critical_battery_{{ trigger.entity_id.split('.')[1] }}
- id: evening_brushing_reminder
  alias: 저녁 양치 알림
  triggers:
  - trigger: time
    at: '22:00:00'
  conditions:
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
  - condition: template
    value_template: '{{ (now() - states.sensor.smart_series_7000_6f50.last_changed).total_seconds()
      > 7200 }}

      '
  actions:
  - action: persistent_notification.create
    data:
      title: "\U0001FAA5 양치 알림"
      message: 최근 2시간 동안 양치 기록이 없습니다.
      notification_id: brushing_reminder
- id: high_heart_rate_alert
  alias: 심박수 경고
  triggers:
  - trigger: numeric_state
    entity_id: sensor.ble_heart_rate_e0e33e6221b5
    above: 120
    for: 00:01:00
  actions:
  - action: persistent_notification.create
    data:
      title: ❤️ 심박수 경고
      message: 심박수가 120bpm 이상으로 상승했습니다. 상태를 확인하세요.
      notification_id: heart_rate_alert
- id: daily_steps_goal_achievement
  alias: 일일 걸음수 목표 달성
  triggers:
  - trigger: numeric_state
    entity_id: sensor.ble_steps_e0e33e6221b5
    above: 10000
  conditions:
  - condition: template
    value_template: '{{ (now().date() - states.sensor.ble_steps_e0e33e6221b5.last_changed.date()).days
      == 0 }}

      '
  actions:
  - action: persistent_notification.create
    data:
      title: "\U0001F389 걸음수 목표 달성!"
      message: "축하합니다! 오늘 {{ states('sensor.ble_steps_e0e33e6221b5') }}보를 걸으셨네요. 건강한
        하루를 보내고 계시는군요! \U0001F44F\n"
      notification_id: steps_goal_achieved
- id: kimchi_fridge_temperature_alert
  alias: 김치냉장고 온도 이상
  triggers:
  - trigger: numeric_state
    entity_id: sensor.kimchi_fridge_avg_temperature
    above: 5
    for: 00:30:00
  - trigger: numeric_state
    entity_id: sensor.kimchi_fridge_avg_temperature
    below: -5
    for: 00:30:00
  actions:
  - action: persistent_notification.create
    data:
      title: "\U0001F96C 김치냉장고 온도 주의"
      message: '김치냉장고 평균 온도가 {{ states(''sensor.kimchi_fridge_avg_temperature'') }}°C입니다.
        적정 온도 범위(-5°C ~ 5°C)를 확인해보세요.

        '
      notification_id: kimchi_fridge_temp_alert
- id: dishwasher_cycle_complete
  alias: 식기세척기 완료 알림
  triggers:
  - trigger: state
    entity_id: sensor.jubang_siggiseceoggi_remaining_time
    to: '0'
  conditions:
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
  actions:
  - action: persistent_notification.create
    data:
      title: "\U0001F37D️ 식기세척기 완료"
      message: '식기세척기 세척이 완료되었습니다!  식기를 꺼내주세요. 총 세척 시간: {{ states(''sensor.jubang_siggiseceoggi_total_time'')
        }}

        '
      notification_id: dishwasher_complete
- id: rinse_aid_refill_reminder
  alias: 린스 보충 알림
  triggers:
  - trigger: state
    entity_id: binary_sensor.jubang_siggiseceoggi_rinse_refill_needed
    from: 'off'
    to: 'on'
  actions:
  - action: persistent_notification.create
    data:
      title: "\U0001F9F4 린스 보충 필요"
      message: '식기세척기 린스 보충이 필요합니다.  현재 잔여량: {{ states(''sensor.jubang_siggiseceoggi_rinse_aid_dispenser_level'')
        }}

        '
      notification_id: rinse_aid_reminder
- id: smart_ac_temperature_control
  alias: 스마트 에어컨 온도 제어
  triggers:
  - trigger: numeric_state
    entity_id: sensor.seutaendeuhyeong_eeokeon_temperature
    above: 28
    for: 00:10:00
  - trigger: numeric_state
    entity_id: sensor.seutaendeuhyeong_eeokeon_temperature
    below: 22
    for: 00:10:00
  conditions:
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
  - condition: state
    entity_id: binary_sensor.workday_sensor
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: numeric_state
        entity_id: sensor.seutaendeuhyeong_eeokeon_temperature
        above: 28
      sequence:
      - action: climate.set_temperature
        target:
          entity_id: climate.seutaendeuhyeong_eeokeon
        data:
          temperature: 24
          hvac_mode: cool
      - action: persistent_notification.create
        data:
          title: ❄️ 에어컨 냉방 자동 시작
          message: 실내 온도가 {{ states('sensor.seutaendeuhyeong_eeokeon_temperature')
            }}°C로 높아져서 냉방을 시작했습니다.
    - conditions:
      - condition: numeric_state
        entity_id: sensor.seutaendeuhyeong_eeokeon_temperature
        below: 22
      sequence:
      - action: climate.turn_off
        target:
          entity_id: climate.seutaendeuhyeong_eeokeon
      - action: persistent_notification.create
        data:
          title: "\U0001F321️ 에어컨 자동 정지"
          message: 실내 온도가 {{ states('sensor.seutaendeuhyeong_eeokeon_temperature')
            }}°C로 적정해져서 에어컨을 껐습니다.
- id: humidity_management_alert
  alias: 습도 관리 알림
  triggers:
  - trigger: numeric_state
    entity_id: sensor.seutaendeuhyeong_eeokeon_humidity
    above: 70
    for: 00:30:00
  - trigger: numeric_state
    entity_id: sensor.seutaendeuhyeong_eeokeon_humidity
    below: 30
    for: 00:30:00
  actions:
  - action: persistent_notification.create
    data:
      title: "\U0001F4A7 습도 관리 필요"
      message: "현재 습도가 {{ states('sensor.seutaendeuhyeong_eeokeon_humidity') }}%입니다.
        {% if trigger.platform == 'numeric_state' and trigger.above is not none %}\n
        \ 습도가 높습니다. 제습을 고려해보세요.\n{% else %}\n  습도가 낮습니다. 가습을 고려해보세요.\n{% endif %}\n"
      notification_id: humidity_alert
- id: sunrise_gradual_lighting
  alias: 일출 조명 서서히 켜기
  triggers:
  - trigger: sun
    event: sunrise
    offset: -00:30:00
  conditions:
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
  - condition: state
    entity_id: binary_sensor.workday_sensor
    state: 'on'
  actions:
  - action: light.turn_on
    target:
      entity_id: light.zigbee_dimmer
    data:
      brightness_pct: 10
      transition: 300
  - delay: 00:15:00
  - action: light.turn_on
    target:
      entity_id: light.zigbee_dimmer
    data:
      brightness_pct: 50
      transition: 900
- id: sunset_auto_lighting
  alias: 일몰 후 자동 조명
  triggers:
  - trigger: sun
    event: sunset
    offset: 00:30:00
  conditions:
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
  actions:
  - action: light.turn_on
    target:
      entity_id:
      - light.zigbee_dimmer
      - light.smart_bulb
    data:
      brightness_pct: 80
      color_temp_kelvin: 2500
- id: bedtime_lights_off
  alias: 취침 시간 조명 끄기
  triggers:
  - trigger: time
    at: '23:30:00'
  conditions:
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
  actions:
  - action: light.turn_on
    target:
      entity_id:
      - light.zigbee_dimmer
      - light.smart_bulb
    data:
      brightness_pct: 20
      transition: 300
  - delay: 00:05:00
  - action: light.turn_off
    target:
      entity_id:
      - light.zigbee_dimmer
      - light.smart_bulb
  - action: persistent_notification.create
    data:
      title: "\U0001F319 좋은 꿈 되세요"
      message: 취침 시간이라 조명을 껐습니다. 좋은 밤 보내세요!
      notification_id: bedtime_lights
- id: workday_morning_briefing
  alias: 근무일 아침 브리핑
  triggers:
  - trigger: time
    at: 07:30:00
  conditions:
  - condition: state
    entity_id: binary_sensor.workday_sensor
    state: 'on'
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
  actions:
  - action: persistent_notification.create
    data:
      title: ☀️ 좋은 아침입니다!
      message: "오늘의 정보를 확인해보세요:\n\U0001F4C5 {{ states('sensor.date') }} \U0001F321️
        실내 온도: {{ states('sensor.seutaendeuhyeong_eeokeon_temperature') }}°C \U0001F4A7
        실내 습도: {{ states('sensor.seutaendeuhyeong_eeokeon_humidity') }}% ⚡ 현재 전력:
        {{ states('sensor.total_power_consumption') }}W \U0001F50B 평균 배터리: {{ states('sensor.average_device_battery')
        }}%\n좋은 하루 되세요! \U0001F4AA\n"
      notification_id: morning_briefing
- id: weekend_sleep_mode
  alias: 주말 늦잠 모드
  triggers:
  - trigger: sun
    event: sunrise
    offset: 02:00:00
  conditions:
  - condition: state
    entity_id: binary_sensor.workday_sensor
    state: 'off'
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
  actions:
  - action: light.turn_on
    target:
      entity_id: light.zigbee_dimmer
    data:
      brightness_pct: 30
      transition: 600
  - action: persistent_notification.create
    data:
      title: "\U0001F634 주말 모드"
      message: 주말이니까 천천히 일어나세요. 조명을 부드럽게 켰습니다.
      notification_id: weekend_mode
- id: gas_send_monthly_telegram
  alias: 가스 검침 사진 보내기
  description: ''
  triggers:
  - at: 09:03:00
    trigger: time
  conditions:
  - condition: template
    value_template: '{{now().day == 26}}'
  actions:
  - variables:
      nowdate: '{{ now().strftime(''%Y-%m-%d'') }}'
      nowtime: '{{ now().strftime(''%Y-%m-%d_%H:%M:%S'') }}'
      nowtimefile: '{{ now().strftime(''%Y%m%d_%H%M%S'') }}'
      nowtimestamp: '{{ now().timestamp() }}'
  - action: pyscript.image_rotate
    metadata: {}
    data:
      input_image: /config/www/tmp/gas/gas_latest.jpg
      output_image: /config/www/tmp/gas/month/gas_{{nowtimefile}}.jpg
      rotation_angle: 0
  - action: notify.telegram_home
    data:
      title: 가스 검침 알림
      message: '검침시간: {{nowdate}}'
      data:
        photo:
        - url: https://ha.aaaa.cc/local/tmp/gas/gas_latest.jpg
          caption: '가스 검침일: {{nowdate}}

            가스 검침: {{states(''sensor.gas_meter_2'')}}

            월간 사용량: {{state_attr(''sensor.gas_meter_monthly'',''last_period'')}}'
    enabled: false
  mode: single
- id: ios_theme_dark_sunset
  alias: iOS 테마 다크모드 (일몰)
  triggers:
  - trigger: sun
    event: sunset
  actions:
  - action: frontend.set_theme
    data:
      name: ios-dark-mode
- id: ios_theme_light_sunrise
  alias: iOS 테마 라이트모드 (일출)
  triggers:
  - trigger: sun
    event: sunrise
  actions:
  - action: frontend.set_theme
    data:
      name: ios-light-mode
- id: '1755698295141'
  alias: 주변 밝기 자동 조명 제어
  description: 주변 밝기가 충분할 때 자동으로 조명을 끕니다.
  triggers:
  - type: illuminance
    device_id: e28ebb70ec49039d225e74b202fdd91e
    entity_id: 4ff6ecbace5417823e81b823fd5bd60e
    domain: sensor
    trigger: device
    below: 20
  conditions: []
  actions:
  - type: turn_off
    device_id: 16c454176737aa10fa53bf309f24d111
    entity_id: f88477c68d783968908c54499f788206
    domain: light
  mode: single
- id: '1755744715659'
  alias: 낮은 임계값 조명 알림
  description: 특정 센서 값이 임계값 미만으로 떨어질 때 조명을 켜서 시각적으로 알립니다.
  triggers:
  - type: value
    device_id: 42940cb04959837ed39a637fed0f69e2
    entity_id: 64ba2d64e316df06c349b58054dcab48
    domain: sensor
    trigger: device
    below: 2
  conditions: []
  actions:
  - type: turn_on
    device_id: 16c454176737aa10fa53bf309f24d111
    entity_id: f88477c68d783968908c54499f788206
    domain: light
    brightness_pct: 100
  mode: single
- id: '1757400245264'
  alias: 가스 검침 사진 촬영
  description: 30분마다 가스 검침기의 조명을 켜고 사진을 촬영한 후, OCR을 위해 이미지를 회전, 자르고 크기를 조절합니다.
  triggers:
  - trigger: time_pattern
    minutes: /30
  conditions: []
  actions:
  - variables:
      year: '{{ now().strftime(''%Y'') }}'
      month: '{{ now().strftime(''%m'') }}'
      day: '{{ now().strftime(''%d'') }}'
      nowtime: '{{ now().strftime(''%Y-%m-%d_%H:%M:%S'') }}'
      nowtimefile: '{{ now().strftime(''%Y%m%d_%H%M%S'') }}'
      nowtimestamp: '{{ now().timestamp() }}'
  - metadata: {}
    data:
      rgb_color:
      - 255
      - 255
      - 255
      brightness_pct: 25
    target:
      entity_id: light.esp32_cam_esp32_cam_gas_light
    action: light.turn_on
    enabled: true
  - delay:
      hours: 0
      minutes: 0
      seconds: 5
      milliseconds: 0
  - metadata: {}
    data:
      filename: /config/www/tmp/gas/gas_latest.jpg
    action: camera.snapshot
    target:
      entity_id: camera.esp32_cam_esp32_cam_gas_cam
  - alias: OCR 준비(크롭/리사이즈/분할) – pyscript 단일 호출
    action: pyscript.gas_ocr_prepare
    data:
      input_image: /config/www/tmp/gas/gas_latest.jpg
      crop_output: /config/www/tmp/gas/gas_latest-crop.jpg
      resize_output: /config/www/tmp/gas/gas_latest-crop-resize.jpg
      int_output: /config/www/tmp/gas/gas_latest-crop-resize1.jpg
      frac_output: /config/www/tmp/gas/gas_latest-crop-resize2.jpg
  - metadata: {}
    data:
      input_image: /config/www/tmp/gas/gas_latest-crop.jpg
      output_image: /config/www/tmp/gas/{{year}}/{{month}}/{{day}}/gas_{{nowtimefile}}.jpg
      rotation_angle: 0
    alias: 날짜폴더로 복사
    enabled: false
    action: pyscript.image_rotate
  - metadata: {}
    data: {}
    target:
      entity_id: light.esp32_cam_esp32_cam_gas_light
    action: light.turn_off
    enabled: true
  mode: single
- id: '1757400336693'
  alias: 가스 검침 숫자 자동 판독
  description: 가스 미터 사진에서 숫자를 자동으로 읽어 가스 사용량을 업데이트합니다.
  triggers:
  - trigger: time_pattern
    minutes: /30
    seconds: '30'
  conditions: []
  actions:
  - action: ai_task.generate_data
    data:
      attachments:
        media_content_id: media-source://media_source/local/tmp/gas/gas_latest-crop-resize1.jpg
        media_content_type: image/jpeg
        metadata:
          title: gas_latest-crop-resize1.jpg
          thumbnail:
          media_class: image
          children_media_class:
          navigateIds:
          - {}
          - media_content_type: app
            media_content_id: media-source://media_source
      instructions: 'This is a gas meter display showing the integer part (whole numbers).
        Read ONLY the visible digits from left to right. Return ONLY the numbers without
        any spaces, units, or explanations. Example: If you see "00123", answer "123".
        If digits are unclear, make your best estimation based on the shape.'
      task_name: 가스 검침 숫자 읽기1 (정수부)
      entity_id: ai_task.google_ai_task
    response_variable: res1
  - action: ai_task.generate_data
    data:
      attachments:
        media_content_id: media-source://media_source/local/tmp/gas/gas_latest-crop-resize2.jpg
        media_content_type: image/jpeg
        metadata:
          title: gas_latest-crop-resize2.jpg
          thumbnail:
          media_class: image
          children_media_class:
          navigateIds:
          - {}
          - media_content_type: app
            media_content_id: media-source://media_source
      instructions: 'This is a gas meter display showing the decimal part (four digits
        after decimal point). Read EXACTLY 4 digits from left to right, even if they
        start with zeros. Return ONLY the 4-digit number without any spaces, decimal
        points, units, or explanations. Example: If you see "0638", answer "0638" (not
        "638"). If digits are unclear, make your best estimation based on the shape.'
      task_name: 가스 검침 숫자 읽기2 (소수부)
      entity_id: ai_task.google_ai_task
    response_variable: res2
  - action: input_text.set_value
    metadata: {}
    data:
      value: '{{ now().strftime(''%H:%M:%S'') }} |  정수: {{ res1.data | default(''X'')
        }} |  소수: {{ res2.data | default(''X'') }}'
    target:
      entity_id: input_text.gas_message_2
  - variables:
      gas_value1_raw: '{{ res1.data | default("0") | regex_findall("[0-9]") | join("")
        }}'
      gas_value1: '{{ gas_value1_raw | int(default=0) }}'
      gas_value2_raw: '{{ res2.data | default("0000") | regex_findall("[0-9]") | join("")
        }}'
      # 소수부를 항상 4자리로 유지(선행 0 포함)
      gas_value2_padded: '{{ (gas_value2_raw + "0000")[:4] }}'
      gas_value2: '{{ gas_value2_padded | int(default=0) }}'
      # 4자리 소수로 계산(예: 133.5638)
      gas_value: '{{ ((gas_value1 * 10000 + gas_value2) / 10000) | round(4) }}'
      current_value: '{{ states("sensor.gas_meter_2") | float(default=0) }}'
      delta: '{{ (gas_value | float - current_value) | round(3) }}'
      ocr1_success: '{{ gas_value1_raw | length > 0 }}'
      ocr2_success: '{{ gas_value2_raw | length == 4 }}'
  - if:
    - condition: template
      value_template: '{{ ocr1_success and ocr2_success }}'
    - condition: template
      value_template: '{{ 0 <= delta <= 10 }}'
    - condition: template
      value_template: '{{ gas_value >= current_value }}'
    then:
    - action: input_number.set_value
      metadata: {}
      data:
        value: '{{ gas_value }}'
      target:
        entity_id: input_number.gas_meter_2
    - action: persistent_notification.create
      data:
        title: ✅ 가스 검침 성공
        message: "\U0001F550 시각: {{ now().strftime('%H:%M:%S') }}\n\U0001F4CA 검침값:
          {{ gas_value }} m³\n\U0001F4C8 증가량: +{{ delta }} m³\n\U0001F522 OCR: {{
          gas_value1 }}.{{ gas_value2_padded }}"
        notification_id: gas_ocr_success
    else:
    - action: persistent_notification.create
      data:
        title: ⚠️ 가스 검침 실패
        message: "\U0001F550 시각: {{ now().strftime('%H:%M:%S') }}\n❌ 검증 실패 사유: {%
          if not ocr1_success %}- OCR1 실패 (정수부){% endif %} {% if not ocr2_success
          %}- OCR2 실패 (소수부 {{ gas_value2_raw | length }}자리){% endif %} {% if delta
          < 0 %}- 음수 증가량 ({{ delta }} m³){% endif %} {% if delta > 10 %}- 비정상적 증가
          ({{ delta }} m³){% endif %}\n\U0001F522 읽은 값: {{ gas_value }} m³ (현재: {{
          current_value }} m³)\n\U0001F4DD 원본: \"{{ res1.data | default('X') }}\"
          | \"{{ res2.data | default('X') }}\""
        notification_id: gas_ocr_failed
  mode: single
- id: pi5_fan_auto_on
  alias: Pi5 팬 자동 속도 상승
  description: CPU 온도가 65°C 이상이면 팬을 80%로 설정하고 자동모드 해제
  triggers:
  - trigger: numeric_state
    entity_id: sensor.pi5_cpu_temperature
    above: 65
    for: 00:00:30
  actions:
  - action: pyscript.pi5_fan_set_auto
    data:
      enabled: false
  - action: pyscript.pi5_fan_set_percent
    data:
      percent: 100
  - action: input_boolean.turn_off
    target:
      entity_id: input_boolean.pi5_fan_auto
  - action: persistent_notification.create
    data:
      title: "\U0001F321️ Pi5 팬 속도 80%"
      message: CPU {{ states('sensor.pi5_cpu_temperature') }}°C로 상승하여 팬을 80%로 설정
      notification_id: pi5_fan_auto_on
  mode: single
- id: pi5_fan_auto_down
  alias: Pi5 팬 자동 속도 하향
  description: CPU 온도가 55°C 이하이면 팬을 30%로 낮춤
  triggers:
  - trigger: numeric_state
    entity_id: sensor.pi5_cpu_temperature
    below: 55
    for: 00:02:00
  actions:
  - action: pyscript.pi5_fan_set_percent
    data:
      percent: 30
  - action: persistent_notification.dismiss
    data:
      notification_id: pi5_fan_auto_on
  - action: persistent_notification.create
    data:
      title: ❄️ Pi5 팬 속도 30%
      message: CPU {{ states('sensor.pi5_cpu_temperature') }}°C로 떨어져 팬을 30%로 설정
      notification_id: pi5_fan_auto_off
  mode: single
- id: pi5_fan_critical_temp
  alias: Pi5 CPU 임계 온도 긴급 냉각
  description: CPU 80°C 이상 시 최대속도 100% 설정
  triggers:
  - trigger: numeric_state
    entity_id: sensor.pi5_cpu_temperature
    above: 80
    for: 00:00:30
  actions:
  - action: pyscript.pi5_fan_set_auto
    data:
      enabled: false
  - action: pyscript.pi5_fan_set_percent
    data:
      percent: 100
  - action: persistent_notification.create
    data:
      title: "\U0001F6A8 Pi5 팬 100%"
      message: CPU {{ states('sensor.pi5_cpu_temperature') }}°C - 긴급 냉각 모드
      notification_id: pi5_critical_temp
  mode: restart
- id: '1759067786798'
  alias: 이산화탄소 자동 환기 제어
  description: 실내 이산화탄소 농도가 높아지면 환기 시스템을 자동으로 켭니다.
  triggers:
  - type: carbon_dioxide
    device_id: 685dcb87a40f475d9698f209b98d9445
    entity_id: 66c44ad10cf8d067a683d1d85643f661
    domain: sensor
    trigger: device
    above: 1000
  - type: carbon_dioxide
    device_id: e259081ff966ca34e7e6348b855bcff8
    entity_id: 6b254a896368c12d5edd764be23e81a6
    domain: sensor
    trigger: device
    above: 1000
  conditions:
  - condition: device
    type: is_off
    device_id: 98bda3e8ced3d5a12ee685841e367c15
    entity_id: 99f72fc2d843060f243cb0f5979fe38d
    domain: switch
  actions:
  - type: turn_on
    device_id: 98bda3e8ced3d5a12ee685841e367c15
    entity_id: 99f72fc2d843060f243cb0f5979fe38d
    domain: switch
  - repeat:
      count: 12
      sequence:
      - type: toggle
        device_id: 98bda3e8ced3d5a12ee685841e367c15
        entity_id: 08a45393493c019ceb1c55783651f7e1
        domain: switch
      - delay:
          hours: 0
          minutes: 0
          seconds: 1
          milliseconds: 0
  mode: single
- id: '1759068039218'
  alias: 이산화탄소 자동 환기 하향
  description: 실내 이산화탄소 농도가 기준치 이하로 떨어지면 환기 시스템을 자동으로 끕니다.
  triggers:
  - type: carbon_dioxide
    device_id: 685dcb87a40f475d9698f209b98d9445
    entity_id: 66c44ad10cf8d067a683d1d85643f661
    domain: sensor
    trigger: device
    below: 950
  - type: carbon_dioxide
    device_id: e259081ff966ca34e7e6348b855bcff8
    entity_id: 6b254a896368c12d5edd764be23e81a6
    domain: sensor
    trigger: device
    below: 950
  conditions:
  - condition: device
    type: is_on
    device_id: 98bda3e8ced3d5a12ee685841e367c15
    entity_id: 99f72fc2d843060f243cb0f5979fe38d
    domain: switch
  actions:
  - type: turn_off
    device_id: 98bda3e8ced3d5a12ee685841e367c15
    entity_id: 99f72fc2d843060f243cb0f5979fe38d
    domain: switch
  mode: single
- id: '1759395712039'
  alias: 녹음본 저장 시 로컬 맥으로 복사
  description: ''
  triggers:
  - event_type: voice_recorder_saved
    trigger: event
  actions:
  - data:
      url: '{{ ''https://caredian.gleeze.com'' ~ (trigger.event.data.path | replace(''/config/www'',''/local''))
        }}'
      filename: '{{ trigger.event.data.filename }}'
    action: rest_command.push_record_to_mac
  mode: queued
