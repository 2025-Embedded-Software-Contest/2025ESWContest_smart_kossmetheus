- id: high_power_consumption_alert
  alias: ë†’ì€ ì „ë ¥ ì†Œë¹„ ì•Œë¦¼
  description: ì´ ì „ë ¥ ì†Œë¹„ê°€ ì„ê³„ê°’ì„ ì´ˆê³¼í–ˆì„ ë•Œ ì•Œë¦¼
  triggers:
  - trigger: numeric_state
    entity_id: sensor.total_power_consumption
    above: 500
    for: 00:05:00
  conditions:
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
  actions:
  - action: persistent_notification.create
    data:
      title: âš¡ ì „ë ¥ ì†Œë¹„ ì£¼ì˜
      message: 'í˜„ì¬ ì „ë ¥ ì†Œë¹„ëŸ‰ì´ {{ states(''sensor.total_power_consumption'') }}Wì…ë‹ˆë‹¤. ì—ë„ˆì§€
        ì ˆì•½ì„ ìœ„í•´ ë¶ˆí•„ìš”í•œ ê¸°ê¸°ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.

        '
      notification_id: high_power_alert
- id: energy_saving_mode
  alias: ì—ë„ˆì§€ ì ˆì•½ ëª¨ë“œ
  description: ì§‘ì— ì•„ë¬´ë„ ì—†ì„ ë•Œ ì—ë„ˆì§€ ì ˆì•½
  triggers:
  - trigger: state
    entity_id: binary_sensor.someone_home
    from: 'on'
    to: 'off'
    for: 00:30:00
  actions:
  - action: light.turn_off
    target:
      entity_id:
      - light.zigbee_dimmer
      - light.smart_bulb
  - action: persistent_notification.create
    data:
      title: "\U0001F3E0 ì—ë„ˆì§€ ì ˆì•½ ëª¨ë“œ í™œì„±í™”"
      message: ë¶€ì¬ ì¤‘ì´ë¯€ë¡œ ì¡°ëª…ì„ ìë™ìœ¼ë¡œ êº¼ë‘ì—ˆìŠµë‹ˆë‹¤.
- id: low_battery_device_alert
  alias: ì €ë°°í„°ë¦¬ ë””ë°”ì´ìŠ¤ ì•Œë¦¼
  triggers:
  - trigger: state
    entity_id: binary_sensor.low_battery_devices
    from: 'off'
    to: 'on'
  actions:
  - action: persistent_notification.create
    data:
      title: "\U0001F50B ë°°í„°ë¦¬ ë¶€ì¡± ì£¼ì˜"
      message: "ë°°í„°ë¦¬ê°€ ë¶€ì¡±í•œ ë””ë°”ì´ìŠ¤ê°€ ìˆìŠµë‹ˆë‹¤: {% set devices = [\n  ('Apple Watch', states('sensor.gimuhyeonyi_apple_watch_battery')),\n
        \ ('MacBook Pro', states('sensor.gimuhyeonyi_macbook_pro_battery')),\n  ('iPad
        Pro', states('sensor.uhyeonyi_ipad_pro_battery')),\n  ('iPhone XS', states('sensor.uhyeonyi_iphone_xs_battery'))\n]
        %} {% for device, battery in devices %} {% if battery|int < 20 %} - {{ device
        }}: {{ battery }}% {% endif %} {% endfor %}\n"
      notification_id: low_battery_alert
- id: critical_battery_alert
  alias: ê·¹ì €ë°°í„°ë¦¬ ì•Œë¦¼
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.gimuhyeonyi_apple_watch_battery
    - sensor.gimuhyeonyi_macbook_pro_battery
    - sensor.uhyeonyi_ipad_pro_battery
    - sensor.uhyeonyi_iphone_xs_battery
    below: 10
  actions:
  - action: persistent_notification.create
    data:
      title: "\U0001F6A8 ë°°í„°ë¦¬ ìœ„í—˜ ìˆ˜ì¤€"
      message: '{{ trigger.to_state.attributes.friendly_name }}ì˜ ë°°í„°ë¦¬ê°€ {{ trigger.to_state.state
        }}%ì…ë‹ˆë‹¤. ì¦‰ì‹œ ì¶©ì „í•˜ì„¸ìš”!

        '
      notification_id: critical_battery_{{ trigger.entity_id.split('.')[1] }}
- id: evening_brushing_reminder
  alias: ì €ë… ì–‘ì¹˜ ì•Œë¦¼
  triggers:
  - trigger: time
    at: '22:00:00'
  conditions:
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
  - condition: template
    value_template: '{{ (now() - states.sensor.smart_series_7000_6f50.last_changed).total_seconds()
      > 7200 }}

      '
  actions:
  - action: persistent_notification.create
    data:
      title: "\U0001FAA5 ì–‘ì¹˜ ì•Œë¦¼"
      message: ìµœê·¼ 2ì‹œê°„ ë™ì•ˆ ì–‘ì¹˜ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.
      notification_id: brushing_reminder
- id: high_heart_rate_alert
  alias: ì‹¬ë°•ìˆ˜ ê²½ê³ 
  triggers:
  - trigger: numeric_state
    entity_id: sensor.ble_heart_rate_e0e33e6221b5
    above: 120
    for: 00:01:00
  actions:
  - action: persistent_notification.create
    data:
      title: â¤ï¸ ì‹¬ë°•ìˆ˜ ê²½ê³ 
      message: ì‹¬ë°•ìˆ˜ê°€ 120bpm ì´ìƒìœ¼ë¡œ ìƒìŠ¹í–ˆìŠµë‹ˆë‹¤. ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.
      notification_id: heart_rate_alert
- id: daily_steps_goal_achievement
  alias: ì¼ì¼ ê±¸ìŒìˆ˜ ëª©í‘œ ë‹¬ì„±
  triggers:
  - trigger: numeric_state
    entity_id: sensor.ble_steps_e0e33e6221b5
    above: 10000
  conditions:
  - condition: template
    value_template: '{{ (now().date() - states.sensor.ble_steps_e0e33e6221b5.last_changed.date()).days
      == 0 }}

      '
  actions:
  - action: persistent_notification.create
    data:
      title: "\U0001F389 ê±¸ìŒìˆ˜ ëª©í‘œ ë‹¬ì„±!"
      message: "ì¶•í•˜í•©ë‹ˆë‹¤! ì˜¤ëŠ˜ {{ states('sensor.ble_steps_e0e33e6221b5') }}ë³´ë¥¼ ê±¸ìœ¼ì…¨ë„¤ìš”. ê±´ê°•í•œ
        í•˜ë£¨ë¥¼ ë³´ë‚´ê³  ê³„ì‹œëŠ”êµ°ìš”! \U0001F44F\n"
      notification_id: steps_goal_achieved
- id: kimchi_fridge_temperature_alert
  alias: ê¹€ì¹˜ëƒ‰ì¥ê³  ì˜¨ë„ ì´ìƒ
  triggers:
  - trigger: numeric_state
    entity_id: sensor.kimchi_fridge_avg_temperature
    above: 5
    for: 00:30:00
  - trigger: numeric_state
    entity_id: sensor.kimchi_fridge_avg_temperature
    below: -5
    for: 00:30:00
  actions:
  - action: persistent_notification.create
    data:
      title: "\U0001F96C ê¹€ì¹˜ëƒ‰ì¥ê³  ì˜¨ë„ ì£¼ì˜"
      message: 'ê¹€ì¹˜ëƒ‰ì¥ê³  í‰ê·  ì˜¨ë„ê°€ {{ states(''sensor.kimchi_fridge_avg_temperature'') }}Â°Cì…ë‹ˆë‹¤.
        ì ì • ì˜¨ë„ ë²”ìœ„(-5Â°C ~ 5Â°C)ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.

        '
      notification_id: kimchi_fridge_temp_alert
- id: dishwasher_cycle_complete
  alias: ì‹ê¸°ì„¸ì²™ê¸° ì™„ë£Œ ì•Œë¦¼
  triggers:
  - trigger: state
    entity_id: sensor.jubang_siggiseceoggi_remaining_time
    to: '0'
  conditions:
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
  actions:
  - action: persistent_notification.create
    data:
      title: "\U0001F37Dï¸ ì‹ê¸°ì„¸ì²™ê¸° ì™„ë£Œ"
      message: 'ì‹ê¸°ì„¸ì²™ê¸° ì„¸ì²™ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!  ì‹ê¸°ë¥¼ êº¼ë‚´ì£¼ì„¸ìš”. ì´ ì„¸ì²™ ì‹œê°„: {{ states(''sensor.jubang_siggiseceoggi_total_time'')
        }}

        '
      notification_id: dishwasher_complete
- id: rinse_aid_refill_reminder
  alias: ë¦°ìŠ¤ ë³´ì¶© ì•Œë¦¼
  triggers:
  - trigger: state
    entity_id: binary_sensor.jubang_siggiseceoggi_rinse_refill_needed
    from: 'off'
    to: 'on'
  actions:
  - action: persistent_notification.create
    data:
      title: "\U0001F9F4 ë¦°ìŠ¤ ë³´ì¶© í•„ìš”"
      message: 'ì‹ê¸°ì„¸ì²™ê¸° ë¦°ìŠ¤ ë³´ì¶©ì´ í•„ìš”í•©ë‹ˆë‹¤.  í˜„ì¬ ì”ì—¬ëŸ‰: {{ states(''sensor.jubang_siggiseceoggi_rinse_aid_dispenser_level'')
        }}

        '
      notification_id: rinse_aid_reminder
- id: smart_ac_temperature_control
  alias: ìŠ¤ë§ˆíŠ¸ ì—ì–´ì»¨ ì˜¨ë„ ì œì–´
  triggers:
  - trigger: numeric_state
    entity_id: sensor.seutaendeuhyeong_eeokeon_temperature
    above: 28
    for: 00:10:00
  - trigger: numeric_state
    entity_id: sensor.seutaendeuhyeong_eeokeon_temperature
    below: 22
    for: 00:10:00
  conditions:
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
  - condition: state
    entity_id: binary_sensor.workday_sensor
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: numeric_state
        entity_id: sensor.seutaendeuhyeong_eeokeon_temperature
        above: 28
      sequence:
      - action: climate.set_temperature
        target:
          entity_id: climate.seutaendeuhyeong_eeokeon
        data:
          temperature: 24
          hvac_mode: cool
      - action: persistent_notification.create
        data:
          title: â„ï¸ ì—ì–´ì»¨ ëƒ‰ë°© ìë™ ì‹œì‘
          message: ì‹¤ë‚´ ì˜¨ë„ê°€ {{ states('sensor.seutaendeuhyeong_eeokeon_temperature')
            }}Â°Cë¡œ ë†’ì•„ì ¸ì„œ ëƒ‰ë°©ì„ ì‹œì‘í–ˆìŠµë‹ˆë‹¤.
    - conditions:
      - condition: numeric_state
        entity_id: sensor.seutaendeuhyeong_eeokeon_temperature
        below: 22
      sequence:
      - action: climate.turn_off
        target:
          entity_id: climate.seutaendeuhyeong_eeokeon
      - action: persistent_notification.create
        data:
          title: "\U0001F321ï¸ ì—ì–´ì»¨ ìë™ ì •ì§€"
          message: ì‹¤ë‚´ ì˜¨ë„ê°€ {{ states('sensor.seutaendeuhyeong_eeokeon_temperature')
            }}Â°Cë¡œ ì ì •í•´ì ¸ì„œ ì—ì–´ì»¨ì„ ê»ìŠµë‹ˆë‹¤.
- id: humidity_management_alert
  alias: ìŠµë„ ê´€ë¦¬ ì•Œë¦¼
  triggers:
  - trigger: numeric_state
    entity_id: sensor.seutaendeuhyeong_eeokeon_humidity
    above: 70
    for: 00:30:00
  - trigger: numeric_state
    entity_id: sensor.seutaendeuhyeong_eeokeon_humidity
    below: 30
    for: 00:30:00
  actions:
  - action: persistent_notification.create
    data:
      title: "\U0001F4A7 ìŠµë„ ê´€ë¦¬ í•„ìš”"
      message: "í˜„ì¬ ìŠµë„ê°€ {{ states('sensor.seutaendeuhyeong_eeokeon_humidity') }}%ì…ë‹ˆë‹¤.
        {% if trigger.platform == 'numeric_state' and trigger.above is not none %}\n
        \ ìŠµë„ê°€ ë†’ìŠµë‹ˆë‹¤. ì œìŠµì„ ê³ ë ¤í•´ë³´ì„¸ìš”.\n{% else %}\n  ìŠµë„ê°€ ë‚®ìŠµë‹ˆë‹¤. ê°€ìŠµì„ ê³ ë ¤í•´ë³´ì„¸ìš”.\n{% endif %}\n"
      notification_id: humidity_alert
- id: sunrise_gradual_lighting
  alias: ì¼ì¶œ ì¡°ëª… ì„œì„œíˆ ì¼œê¸°
  triggers:
  - trigger: sun
    event: sunrise
    offset: -00:30:00
  conditions:
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
  - condition: state
    entity_id: binary_sensor.workday_sensor
    state: 'on'
  actions:
  - action: light.turn_on
    target:
      entity_id: light.zigbee_dimmer
    data:
      brightness_pct: 10
      transition: 300
  - delay: 00:15:00
  - action: light.turn_on
    target:
      entity_id: light.zigbee_dimmer
    data:
      brightness_pct: 50
      transition: 900
- id: sunset_auto_lighting
  alias: ì¼ëª° í›„ ìë™ ì¡°ëª…
  triggers:
  - trigger: sun
    event: sunset
    offset: 00:30:00
  conditions:
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
  actions:
  - action: light.turn_on
    target:
      entity_id:
      - light.zigbee_dimmer
      - light.smart_bulb
    data:
      brightness_pct: 80
      color_temp_kelvin: 2500
- id: bedtime_lights_off
  alias: ì·¨ì¹¨ ì‹œê°„ ì¡°ëª… ë„ê¸°
  triggers:
  - trigger: time
    at: '23:30:00'
  conditions:
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
  actions:
  - action: light.turn_on
    target:
      entity_id:
      - light.zigbee_dimmer
      - light.smart_bulb
    data:
      brightness_pct: 20
      transition: 300
  - delay: 00:05:00
  - action: light.turn_off
    target:
      entity_id:
      - light.zigbee_dimmer
      - light.smart_bulb
  - action: persistent_notification.create
    data:
      title: "\U0001F319 ì¢‹ì€ ê¿ˆ ë˜ì„¸ìš”"
      message: ì·¨ì¹¨ ì‹œê°„ì´ë¼ ì¡°ëª…ì„ ê»ìŠµë‹ˆë‹¤. ì¢‹ì€ ë°¤ ë³´ë‚´ì„¸ìš”!
      notification_id: bedtime_lights
- id: workday_morning_briefing
  alias: ê·¼ë¬´ì¼ ì•„ì¹¨ ë¸Œë¦¬í•‘
  triggers:
  - trigger: time
    at: 07:30:00
  conditions:
  - condition: state
    entity_id: binary_sensor.workday_sensor
    state: 'on'
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
  actions:
  - action: persistent_notification.create
    data:
      title: â˜€ï¸ ì¢‹ì€ ì•„ì¹¨ì…ë‹ˆë‹¤!
      message: "ì˜¤ëŠ˜ì˜ ì •ë³´ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”:\n\U0001F4C5 {{ states('sensor.date') }} \U0001F321ï¸
        ì‹¤ë‚´ ì˜¨ë„: {{ states('sensor.seutaendeuhyeong_eeokeon_temperature') }}Â°C \U0001F4A7
        ì‹¤ë‚´ ìŠµë„: {{ states('sensor.seutaendeuhyeong_eeokeon_humidity') }}% âš¡ í˜„ì¬ ì „ë ¥:
        {{ states('sensor.total_power_consumption') }}W \U0001F50B í‰ê·  ë°°í„°ë¦¬: {{ states('sensor.average_device_battery')
        }}%\nì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”! \U0001F4AA\n"
      notification_id: morning_briefing
- id: weekend_sleep_mode
  alias: ì£¼ë§ ëŠ¦ì  ëª¨ë“œ
  triggers:
  - trigger: sun
    event: sunrise
    offset: 02:00:00
  conditions:
  - condition: state
    entity_id: binary_sensor.workday_sensor
    state: 'off'
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
  actions:
  - action: light.turn_on
    target:
      entity_id: light.zigbee_dimmer
    data:
      brightness_pct: 30
      transition: 600
  - action: persistent_notification.create
    data:
      title: "\U0001F634 ì£¼ë§ ëª¨ë“œ"
      message: ì£¼ë§ì´ë‹ˆê¹Œ ì²œì²œíˆ ì¼ì–´ë‚˜ì„¸ìš”. ì¡°ëª…ì„ ë¶€ë“œëŸ½ê²Œ ì¼°ìŠµë‹ˆë‹¤.
      notification_id: weekend_mode
- id: gas_send_monthly_telegram
  alias: ê°€ìŠ¤ ê²€ì¹¨ ì‚¬ì§„ ë³´ë‚´ê¸°
  description: ''
  triggers:
  - at: 09:03:00
    trigger: time
  conditions:
  - condition: template
    value_template: '{{now().day == 26}}'
  actions:
  - variables:
      nowdate: '{{ now().strftime(''%Y-%m-%d'') }}'
      nowtime: '{{ now().strftime(''%Y-%m-%d_%H:%M:%S'') }}'
      nowtimefile: '{{ now().strftime(''%Y%m%d_%H%M%S'') }}'
      nowtimestamp: '{{ now().timestamp() }}'
  - action: pyscript.image_rotate
    metadata: {}
    data:
      input_image: /config/www/tmp/gas/gas_latest.jpg
      output_image: /config/www/tmp/gas/month/gas_{{nowtimefile}}.jpg
      rotation_angle: 0
  - action: notify.telegram_home
    data:
      title: ê°€ìŠ¤ ê²€ì¹¨ ì•Œë¦¼
      message: 'ê²€ì¹¨ì‹œê°„: {{nowdate}}'
      data:
        photo:
        - url: https://ha.aaaa.cc/local/tmp/gas/gas_latest.jpg
          caption: 'ê°€ìŠ¤ ê²€ì¹¨ì¼: {{nowdate}}

            ê°€ìŠ¤ ê²€ì¹¨: {{states(''sensor.gas_meter_2'')}}

            ì›”ê°„ ì‚¬ìš©ëŸ‰: {{state_attr(''sensor.gas_meter_monthly'',''last_period'')}}'
    enabled: false
  mode: single
- id: ios_theme_dark_sunset
  alias: iOS í…Œë§ˆ ë‹¤í¬ëª¨ë“œ (ì¼ëª°)
  triggers:
  - trigger: sun
    event: sunset
  actions:
  - action: frontend.set_theme
    data:
      name: ios-dark-mode
- id: ios_theme_light_sunrise
  alias: iOS í…Œë§ˆ ë¼ì´íŠ¸ëª¨ë“œ (ì¼ì¶œ)
  triggers:
  - trigger: sun
    event: sunrise
  actions:
  - action: frontend.set_theme
    data:
      name: ios-light-mode
- id: '1755698295141'
  alias: ì£¼ë³€ ë°ê¸° ìë™ ì¡°ëª… ì œì–´
  description: ì£¼ë³€ ë°ê¸°ê°€ ì¶©ë¶„í•  ë•Œ ìë™ìœ¼ë¡œ ì¡°ëª…ì„ ë•ë‹ˆë‹¤.
  triggers:
  - type: illuminance
    device_id: e28ebb70ec49039d225e74b202fdd91e
    entity_id: 4ff6ecbace5417823e81b823fd5bd60e
    domain: sensor
    trigger: device
    below: 20
  conditions: []
  actions:
  - type: turn_off
    device_id: 16c454176737aa10fa53bf309f24d111
    entity_id: f88477c68d783968908c54499f788206
    domain: light
  mode: single
- id: '1755744715659'
  alias: ë‚®ì€ ì„ê³„ê°’ ì¡°ëª… ì•Œë¦¼
  description: íŠ¹ì • ì„¼ì„œ ê°’ì´ ì„ê³„ê°’ ë¯¸ë§Œìœ¼ë¡œ ë–¨ì–´ì§ˆ ë•Œ ì¡°ëª…ì„ ì¼œì„œ ì‹œê°ì ìœ¼ë¡œ ì•Œë¦½ë‹ˆë‹¤.
  triggers:
  - type: value
    device_id: 42940cb04959837ed39a637fed0f69e2
    entity_id: 64ba2d64e316df06c349b58054dcab48
    domain: sensor
    trigger: device
    below: 2
  conditions: []
  actions:
  - type: turn_on
    device_id: 16c454176737aa10fa53bf309f24d111
    entity_id: f88477c68d783968908c54499f788206
    domain: light
    brightness_pct: 100
  mode: single
- id: '1757400245264'
  alias: ê°€ìŠ¤ ê²€ì¹¨ ì‚¬ì§„ ì´¬ì˜
  description: 30ë¶„ë§ˆë‹¤ ê°€ìŠ¤ ê²€ì¹¨ê¸°ì˜ ì¡°ëª…ì„ ì¼œê³  ì‚¬ì§„ì„ ì´¬ì˜í•œ í›„, OCRì„ ìœ„í•´ ì´ë¯¸ì§€ë¥¼ íšŒì „, ìë¥´ê³  í¬ê¸°ë¥¼ ì¡°ì ˆí•©ë‹ˆë‹¤.
  triggers:
  - trigger: time_pattern
    minutes: /30
  conditions: []
  actions:
  - variables:
      year: '{{ now().strftime(''%Y'') }}'
      month: '{{ now().strftime(''%m'') }}'
      day: '{{ now().strftime(''%d'') }}'
      nowtime: '{{ now().strftime(''%Y-%m-%d_%H:%M:%S'') }}'
      nowtimefile: '{{ now().strftime(''%Y%m%d_%H%M%S'') }}'
      nowtimestamp: '{{ now().timestamp() }}'
  - metadata: {}
    data:
      brightness_pct: 78
      rgb_color:
      - 255
      - 255
      - 255
    target:
      entity_id: light.esp32_cam_esp32_cam_gas_light
    action: light.turn_on
    enabled: true
  - delay:
      hours: 0
      minutes: 0
      seconds: 2
  - metadata: {}
    data:
      filename: /config/www/tmp/gas/gas_latest.jpg
    action: camera.snapshot
    target:
      entity_id: camera.esp32_cam_esp32_cam_gas_cam
  - metadata: {}
    data:
      input_image: /config/www/tmp/gas/gas_latest.jpg
      output_image: /config/www/tmp/gas/gas_latest.jpg
      rotation_angle: 0
    action: pyscript.image_rotate
  - metadata: {}
    data:
      input_image: /config/www/tmp/gas/gas_latest.jpg
      output_image: /config/www/tmp/gas/gas_latest-crop.jpg
      rotation_angle_before: 0
      left: 200
      top: 400
      right: 1400
      bottom: 650
      rotation_angle: 0
    action: pyscript.image_crop
  - metadata: {}
    data:
      input_image: /config/www/tmp/gas/gas_latest-crop.jpg
      output_image: /config/www/tmp/gas/gas_latest-crop-resize.jpg
      width: 300
      height: 0
    action: pyscript.image_resize
  - alias: ì•ìë¦¬ ë¶„ë¦¬
    metadata: {}
    data:
      input_image: /config/www/tmp/gas/gas_latest-crop-resize.jpg
      output_image: /config/www/tmp/gas/gas_latest-crop-resize1.jpg
      rotation_angle_before: 0
      left: 0
      top: 0
      right: 180
      bottom: 60
      rotation_angle: 0
    action: pyscript.image_crop
  - alias: ë’·ìë¦¬ ë¶„ë¦¬
    metadata: {}
    data:
      input_image: /config/www/tmp/gas/gas_latest-crop-resize.jpg
      output_image: /config/www/tmp/gas/gas_latest-crop-resize2.jpg
      rotation_angle_before: 0
      left: 181
      top: 0
      right: 300
      bottom: 60
      rotation_angle: 0
    action: pyscript.image_crop
  - metadata: {}
    data:
      input_image: /config/www/tmp/gas/gas_latest-crop.jpg
      output_image: /config/www/tmp/gas/{{year}}/{{month}}/{{day}}/gas_{{nowtimefile}}.jpg
      rotation_angle: 0
    alias: ë‚ ì§œí´ë”ë¡œ ë³µì‚¬
    enabled: false
    action: pyscript.image_rotate
  - metadata: {}
    data: {}
    target:
      entity_id: light.esp32_cam_esp32_cam_gas_light
    action: light.turn_off
    enabled: true
  mode: single
- id: '1757400336693'
  alias: ê°€ìŠ¤ ê²€ì¹¨ ìˆ«ì ìë™ íŒë…
  description: ê°€ìŠ¤ ë¯¸í„° ì‚¬ì§„ì—ì„œ ìˆ«ìë¥¼ ìë™ìœ¼ë¡œ ì½ì–´ ê°€ìŠ¤ ì‚¬ìš©ëŸ‰ì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
  triggers:
  - trigger: time_pattern
    minutes: /30
    seconds: '30'
  conditions: []
  actions:
  # ===== AI OCR: ì •ìˆ˜ë¶€ (ì•ìë¦¬) ì½ê¸° =====
  - action: ai_task.generate_data
    data:
      attachments:
        media_content_id: media-source://media_source/local/tmp/gas/gas_latest-crop-resize1.jpg
        media_content_type: image/jpeg
        metadata:
          title: gas_latest-crop-resize1.jpg
          thumbnail:
          media_class: image
          children_media_class:
          navigateIds:
          - {}
          - media_content_type: app
            media_content_id: media-source://media_source
      instructions: >-
        This is a gas meter display showing the integer part (whole numbers).
        Read ONLY the visible digits from left to right.
        Return ONLY the numbers without any spaces, units, or explanations.
        Example: If you see "00123", answer "123".
        If digits are unclear, make your best estimation based on the shape.
      task_name: ê°€ìŠ¤ ê²€ì¹¨ ìˆ«ì ì½ê¸°1 (ì •ìˆ˜ë¶€)
      entity_id: ai_task.google_ai_task
    response_variable: res1
  
  # ===== AI OCR: ì†Œìˆ˜ë¶€ (ë’·ìë¦¬) ì½ê¸° =====
  - action: ai_task.generate_data
    data:
      attachments:
        media_content_id: media-source://media_source/local/tmp/gas/gas_latest-crop-resize2.jpg
        media_content_type: image/jpeg
        metadata:
          title: gas_latest-crop-resize2.jpg
          thumbnail:
          media_class: image
          children_media_class:
          navigateIds:
          - {}
          - media_content_type: app
            media_content_id: media-source://media_source
      instructions: >-
        This is a gas meter display showing the decimal part (three digits after decimal point).
        Read EXACTLY 3 digits from left to right, even if they start with zeros.
        Return ONLY the 3-digit number without any spaces, decimal points, units, or explanations.
        Example: If you see "045", answer "045" (not "45").
        If digits are unclear, make your best estimation based on the shape.
      task_name: ê°€ìŠ¤ ê²€ì¹¨ ìˆ«ì ì½ê¸°2 (ì†Œìˆ˜ë¶€)
      entity_id: ai_task.google_ai_task
    response_variable: res2
  
  # ===== ë””ë²„ê¹…: OCR ê²°ê³¼ë¥¼ input_textì— ì €ì¥ =====
  - action: input_text.set_value
    metadata: {}
    data:
      value: >-
        {{ now().strftime('%H:%M:%S') }} | 
        ì •ìˆ˜: {{ res1.data | default('X') }} | 
        ì†Œìˆ˜: {{ res2.data | default('X') }}
    target:
      entity_id: input_text.gas_message_2
  
  # ===== ìˆ«ì ì¶”ì¶œ ë° ê²€ì¦ =====
  - variables:
      # ì •ìˆ˜ë¶€: ëª¨ë“  ìˆ«ìë§Œ ì¶”ì¶œ
      gas_value1_raw: '{{ res1.data | default("0") | regex_findall("[0-9]") | join("") }}'
      gas_value1: '{{ gas_value1_raw | int(default=0) }}'
      
      # ì†Œìˆ˜ë¶€: ëª¨ë“  ìˆ«ìë§Œ ì¶”ì¶œ (3ìë¦¬ì—¬ì•¼ í•¨)
      gas_value2_raw: '{{ res2.data | default("000") | regex_findall("[0-9]") | join("") }}'
      gas_value2_padded: '{{ (gas_value2_raw + "000")[:3] }}'
      gas_value2: '{{ gas_value2_padded | int(default=0) }}'
      
      # ìµœì¢… ê°€ìŠ¤ ê²€ì¹¨ê°’ (ì •ìˆ˜.ì†Œìˆ˜)
      gas_value: '{{ ((gas_value1 * 1000 + gas_value2) / 1000) | round(3) }}'
      
      # í˜„ì¬ ì„¼ì„œê°’
      current_value: '{{ states("sensor.gas_meter_2") | float(default=0) }}'
      
      # ì¦ê°€ëŸ‰ ê³„ì‚°
      delta: '{{ (gas_value | float - current_value) | round(3) }}'
      
      # OCR ì„±ê³µ ì—¬ë¶€ ì²´í¬
      ocr1_success: '{{ gas_value1_raw | length > 0 }}'
      ocr2_success: '{{ gas_value2_raw | length == 3 }}'
  
  # ===== ê²€ì¦ ë° ì—…ë°ì´íŠ¸ =====
  - if:
    # ì¡°ê±´ 1: OCR ê²°ê³¼ê°€ ìœ íš¨í•´ì•¼ í•¨
    - condition: template
      value_template: '{{ ocr1_success and ocr2_success }}'
    # ì¡°ê±´ 2: ì¦ê°€ëŸ‰ì´ í•©ë¦¬ì  ë²”ìœ„ ë‚´ (0 <= delta <= 10 mÂ³)
    - condition: template
      value_template: '{{ 0 <= delta <= 10 }}'
    # ì¡°ê±´ 3: ì½ì€ ê°’ì´ í˜„ì¬ê°’ë³´ë‹¤ ì‘ì§€ ì•Šì•„ì•¼ í•¨ (ê°€ìŠ¤ëŠ” ëˆ„ì )
    - condition: template
      value_template: '{{ gas_value >= current_value }}'
    then:
    # ===== ì„±ê³µ: ì„¼ì„œ ì—…ë°ì´íŠ¸ =====
    - action: input_number.set_value
      metadata: {}
      data:
        value: '{{ gas_value }}'
      target:
        entity_id: input_number.gas_meter_2
    
    - action: persistent_notification.create
      data:
        title: "âœ… ê°€ìŠ¤ ê²€ì¹¨ ì„±ê³µ"
        message: >-
          ğŸ• ì‹œê°: {{ now().strftime('%H:%M:%S') }}
          
          ğŸ“Š ê²€ì¹¨ê°’: {{ gas_value }} mÂ³
          
          ğŸ“ˆ ì¦ê°€ëŸ‰: +{{ delta }} mÂ³
          
          ğŸ”¢ OCR: {{ gas_value1 }}.{{ gas_value2_padded }}
        notification_id: gas_ocr_success
    else:
    # ===== ì‹¤íŒ¨: ì•Œë¦¼ë§Œ ìƒì„± =====
    - action: persistent_notification.create
      data:
        title: "âš ï¸ ê°€ìŠ¤ ê²€ì¹¨ ì‹¤íŒ¨"
        message: >-
          ğŸ• ì‹œê°: {{ now().strftime('%H:%M:%S') }}
          
          âŒ ê²€ì¦ ì‹¤íŒ¨ ì‚¬ìœ :
          {% if not ocr1_success %}- OCR1 ì‹¤íŒ¨ (ì •ìˆ˜ë¶€){% endif %}
          {% if not ocr2_success %}- OCR2 ì‹¤íŒ¨ (ì†Œìˆ˜ë¶€ {{ gas_value2_raw | length }}ìë¦¬){% endif %}
          {% if delta < 0 %}- ìŒìˆ˜ ì¦ê°€ëŸ‰ ({{ delta }} mÂ³){% endif %}
          {% if delta > 10 %}- ë¹„ì •ìƒì  ì¦ê°€ ({{ delta }} mÂ³){% endif %}
          
          ğŸ”¢ ì½ì€ ê°’: {{ gas_value }} mÂ³ (í˜„ì¬: {{ current_value }} mÂ³)
          
          ğŸ“ ì›ë³¸: "{{ res1.data | default('X') }}" | "{{ res2.data | default('X') }}"
        notification_id: gas_ocr_failed
  mode: single
- id: pi5_fan_auto_on
  alias: Pi5 íŒ¬ ìë™ ì†ë„ ìƒìŠ¹
  description: CPU ì˜¨ë„ê°€ 65Â°C ì´ìƒì´ë©´ íŒ¬ì„ 80%ë¡œ ì„¤ì •í•˜ê³  ìë™ëª¨ë“œ í•´ì œ
  triggers:
  - trigger: numeric_state
    entity_id: sensor.pi5_cpu_temperature
    above: 65
    for: 00:00:30
  actions:
  - action: pyscript.pi5_fan_set_auto
    data:
      enabled: false
  - action: pyscript.pi5_fan_set_percent
    data:
      percent: 100
  - action: input_boolean.turn_off
    target:
      entity_id: input_boolean.pi5_fan_auto
  - action: persistent_notification.create
    data:
      title: "\U0001F321ï¸ Pi5 íŒ¬ ì†ë„ 80%"
      message: CPU {{ states('sensor.pi5_cpu_temperature') }}Â°Cë¡œ ìƒìŠ¹í•˜ì—¬ íŒ¬ì„ 80%ë¡œ ì„¤ì •
      notification_id: pi5_fan_auto_on
  mode: single
- id: pi5_fan_auto_down
  alias: Pi5 íŒ¬ ìë™ ì†ë„ í•˜í–¥
  description: CPU ì˜¨ë„ê°€ 55Â°C ì´í•˜ì´ë©´ íŒ¬ì„ 30%ë¡œ ë‚®ì¶¤
  triggers:
  - trigger: numeric_state
    entity_id: sensor.pi5_cpu_temperature
    below: 55
    for: 00:02:00
  actions:
  - action: pyscript.pi5_fan_set_percent
    data:
      percent: 30
  - action: persistent_notification.dismiss
    data:
      notification_id: pi5_fan_auto_on
  - action: persistent_notification.create
    data:
      title: â„ï¸ Pi5 íŒ¬ ì†ë„ 30%
      message: CPU {{ states('sensor.pi5_cpu_temperature') }}Â°Cë¡œ ë–¨ì–´ì ¸ íŒ¬ì„ 30%ë¡œ ì„¤ì •
      notification_id: pi5_fan_auto_off
  mode: single
- id: pi5_fan_critical_temp
  alias: Pi5 CPU ì„ê³„ ì˜¨ë„ ê¸´ê¸‰ ëƒ‰ê°
  description: CPU 80Â°C ì´ìƒ ì‹œ ìµœëŒ€ì†ë„ 100% ì„¤ì •
  triggers:
  - trigger: numeric_state
    entity_id: sensor.pi5_cpu_temperature
    above: 80
    for: 00:00:30
  actions:
  - action: pyscript.pi5_fan_set_auto
    data:
      enabled: false
  - action: pyscript.pi5_fan_set_percent
    data:
      percent: 100
  - action: persistent_notification.create
    data:
      title: "\U0001F6A8 Pi5 íŒ¬ 100%"
      message: CPU {{ states('sensor.pi5_cpu_temperature') }}Â°C - ê¸´ê¸‰ ëƒ‰ê° ëª¨ë“œ
      notification_id: pi5_critical_temp
  mode: restart
- id: '1759067786798'
  alias: ì´ì‚°í™”íƒ„ì†Œ ìë™ í™˜ê¸° ì œì–´
  description: ì‹¤ë‚´ ì´ì‚°í™”íƒ„ì†Œ ë†ë„ê°€ ë†’ì•„ì§€ë©´ í™˜ê¸° ì‹œìŠ¤í…œì„ ìë™ìœ¼ë¡œ ì¼­ë‹ˆë‹¤.
  triggers:
  - type: carbon_dioxide
    device_id: 685dcb87a40f475d9698f209b98d9445
    entity_id: 66c44ad10cf8d067a683d1d85643f661
    domain: sensor
    trigger: device
    above: 1000
  - type: carbon_dioxide
    device_id: e259081ff966ca34e7e6348b855bcff8
    entity_id: 6b254a896368c12d5edd764be23e81a6
    domain: sensor
    trigger: device
    above: 1000
  conditions:
  - condition: device
    type: is_off
    device_id: 98bda3e8ced3d5a12ee685841e367c15
    entity_id: 99f72fc2d843060f243cb0f5979fe38d
    domain: switch
  actions:
  - type: turn_on
    device_id: 98bda3e8ced3d5a12ee685841e367c15
    entity_id: 99f72fc2d843060f243cb0f5979fe38d
    domain: switch
  - repeat:
      count: 12
      sequence:
      - type: toggle
        device_id: 98bda3e8ced3d5a12ee685841e367c15
        entity_id: 08a45393493c019ceb1c55783651f7e1
        domain: switch
      - delay:
          hours: 0
          minutes: 0
          seconds: 1
          milliseconds: 0
  mode: single
- id: '1759068039218'
  alias: ì´ì‚°í™”íƒ„ì†Œ ìë™ í™˜ê¸° í•˜í–¥
  description: ì‹¤ë‚´ ì´ì‚°í™”íƒ„ì†Œ ë†ë„ê°€ ê¸°ì¤€ì¹˜ ì´í•˜ë¡œ ë–¨ì–´ì§€ë©´ í™˜ê¸° ì‹œìŠ¤í…œì„ ìë™ìœ¼ë¡œ ë•ë‹ˆë‹¤.
  triggers:
  - type: carbon_dioxide
    device_id: 685dcb87a40f475d9698f209b98d9445
    entity_id: 66c44ad10cf8d067a683d1d85643f661
    domain: sensor
    trigger: device
    below: 950
  - type: carbon_dioxide
    device_id: e259081ff966ca34e7e6348b855bcff8
    entity_id: 6b254a896368c12d5edd764be23e81a6
    domain: sensor
    trigger: device
    below: 950
  conditions:
  - condition: device
    type: is_on
    device_id: 98bda3e8ced3d5a12ee685841e367c15
    entity_id: 99f72fc2d843060f243cb0f5979fe38d
    domain: switch
  actions:
  - type: turn_off
    device_id: 98bda3e8ced3d5a12ee685841e367c15
    entity_id: 99f72fc2d843060f243cb0f5979fe38d
    domain: switch
  mode: single
