- id: diagnostics_unavailable_entities
  alias: Diagnostics - Notify unavailable entities
  description: "ì£¼ê¸°ì ìœ¼ë¡œ 'unavailable'/'unknown' ì—”í‹°í‹° ëª©ë¡ì„ ì•Œë¦¼ìœ¼ë¡œ í‘œì‹œí•©ë‹ˆë‹¤."
  trigger:
    - platform: homeassistant
      event: start
    - platform: time_pattern
      minutes: "/15"
  condition: []
  action:
    - variables:
        problem_list: >-
          {{ states | selectattr('state', 'in', ['unavailable','unknown'])
                     | map(attribute='entity_id') | list }}
    - choose:
        - conditions: "{{ problem_list | length > 0 }}"
          sequence:
            - service: persistent_notification.create
              data:
                title: >-
                  Unavailable/Unknown entities ({{ problem_list | length }})
                message: >-
                  {{ problem_list | join('\n') }}
                notification_id: unavailable_entities
        - conditions: "{{ problem_list | length == 0 }}"
          sequence:
            - service: persistent_notification.dismiss
              data:
                notification_id: unavailable_entities
  mode: restart

- id: enhanced_unavailable_monitoring
  alias: Enhanced Unavailable Entities Monitoring
  description: "í–¥ìƒëœ unavailable ì—”í‹°í‹° ëª¨ë‹ˆí„°ë§ ë° ë¶„ë¥˜ ì‹œìŠ¤í…œ"
  trigger:
    - platform: homeassistant
      event: start
    - platform: time_pattern
      minutes: "/10"
    - platform: state
      entity_id: sensor.unavailable_entities_count
  condition: []
  action:
    - variables:
        all_unavailable: >-
          {{ states | selectattr('state', 'in', ['unavailable','unknown'])
                     | map(attribute='entity_id') | list }}
        classifications:
          thinq_fridge: >-
            {{ all_unavailable | select('match', 'sensor.jubang_gimcinaengjanggo.*temperature') | list }}
          thinq_dishwasher: >-
            {{ all_unavailable | select('match', 'sensor.jubang_siggiseceoggi.*') | list }}
          apple_batteries: >-
            {{ all_unavailable | select('match', 'sensor..*battery') | list }}
          ble_sensors: >-
            {{ all_unavailable | select('match', '.*ble.*') | list }}
          xbox_entities: >-
            {{ all_unavailable | select('match', '.*xbox.*') | list }}
          network_sensors: >-
            {{ all_unavailable | select('match', 'sensor..*router.*|sensor.fast_com.*') | list }}
          other_sensors: >-
            {{ all_unavailable | reject('match', 'sensor.jubang_.*|sensor..*battery|.*ble.*|.*xbox.*|sensor..*router.*|sensor.fast_com.*') | list }}
    - service: system_log.write
      data:
        message: >
          ğŸ” Unavailable Entities ë¶„ì„ ê²°ê³¼:
          ğŸ“Š ì´ê³„: {{ all_unavailable | length }}ê°œ
          
          ğŸ“‚ ì¹´í…Œê³ ë¦¬ë³„ ë¶„ì„:
          ğŸ§Š ê¹€ì¹˜ëƒ‰ì¥ê³  ì˜¨ë„: {{ classifications.thinq_fridge | length }}ê°œ
          ğŸ½ï¸ ì‹ê¸°ì„¸ì²™ê¸°: {{ classifications.thinq_dishwasher | length }}ê°œ  
          ğŸ”‹ Apple ë°°í„°ë¦¬: {{ classifications.apple_batteries | length }}ê°œ
          ğŸ“¡ BLE ì„¼ì„œ: {{ classifications.ble_sensors | length }}ê°œ
          ğŸ® Xbox: {{ classifications.xbox_entities | length }}ê°œ
          ğŸŒ ë„¤íŠ¸ì›Œí¬: {{ classifications.network_sensors | length }}ê°œ
          â“ ê¸°íƒ€: {{ classifications.other_sensors | length }}ê°œ
        level: info
    - choose:
        - conditions: "{{ classifications.thinq_fridge | length > 0 }}"
          sequence:
            - service: persistent_notification.create
              data:
                title: "âš ï¸ ê¹€ì¹˜ëƒ‰ì¥ê³  ì˜¨ë„ ì„¼ì„œ ë¬¸ì œ"
                message: >
                  **ë¬¸ì œ ì„¼ì„œë“¤:**
                  {{ classifications.thinq_fridge | join('\n') }}
                  
                  **ì˜í–¥ë„ ë¶„ì„:**
                  - í‰ê·  ì˜¨ë„ ì„¼ì„œ: {{ 'PARTIAL' if classifications.thinq_fridge | length < 4 else 'DOWN' }}
                  - ì‚¬ìš© ê°€ëŠ¥í•œ ì„¼ì„œ: {{ states.sensor.kimchi_fridge_avg_temperature.attributes.available_sensors | default('unknown') }}
                  
                  **ê¶Œì¥ ì¡°ì¹˜:**
                  1. ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰: `thinq_integration_reload`
                  2. LG ThinQ ì•±ì—ì„œ ê¸°ê¸° ìƒíƒœ í™•ì¸
                  3. ë„¤íŠ¸ì›Œí¬ ì—°ê²° ìƒíƒœ ì ê²€
                notification_id: thinq_fridge_alert
    - choose:
        - conditions: "{{ classifications.apple_batteries | length > 0 }}"
          sequence:
            - service: persistent_notification.create
              data:
                title: "ğŸ Apple ê¸°ê¸° ë°°í„°ë¦¬ ì„¼ì„œ ë¬¸ì œ"
                message: >
                  **ë¬¸ì œ ì„¼ì„œë“¤:**
                  {{ classifications.apple_batteries | join('\n') }}
                  
                  **ê¶Œì¥ ì¡°ì¹˜:**
                  1. iCloud3 í†µí•© ìƒíƒœ í™•ì¸
                  2. ê° ê¸°ê¸°ì—ì„œ Home Assistant Companion ì•± í™•ì¸
                  3. "ë‚˜ì˜ ì°¾ê¸°" í™œì„±í™” ì—¬ë¶€ í™•ì¸
                  4. ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰: `apple_devices_battery_check`
                notification_id: apple_battery_alert
    - choose:
        - conditions: "{{ classifications.ble_sensors | length > 0 }}"
          sequence:
            - service: persistent_notification.create
              data:
                title: "ğŸ“¡ BLE ì„¼ì„œ ì—°ê²° ë¬¸ì œ"
                message: >
                  **ë¬¸ì œ ì„¼ì„œë“¤:**
                  {{ classifications.ble_sensors | join('\n') }}
                  
                  **ê¶Œì¥ ì¡°ì¹˜:**
                  1. ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰: `bluetooth_adapter_reset`
                  2. BLE ì¥ì¹˜ë“¤ ë¬¼ë¦¬ì  ì¬ë¶€íŒ…
                  3. ë¸”ë£¨íˆ¬ìŠ¤ ì–´ëŒ‘í„° ì „ì› ê´€ë¦¬ ì„¤ì • í™•ì¸
                notification_id: ble_sensor_alert
    - service: persistent_notification.create
      data:
        title: "ğŸ“Š ì‹œìŠ¤í…œ ìƒíƒœ ìš”ì•½"
        message: >
          **ì „ì²´ ì‹œìŠ¤í…œ ìƒíƒœ** ({{ now().strftime('%Y-%m-%d %H:%M') }})
          
          ğŸŸ¢ **ì •ìƒ ì‘ë™ ì¤‘:**
          - ì‹œìŠ¤í…œ ì„¼ì„œ: {{ states.sensor | selectattr('entity_id', 'match', 'sensor.(processor_use|memory_use_percent|disk_use_percent)') | selectattr('state', 'ne', 'unavailable') | list | length }}/3
          - ì „ë ¥ ì„¼ì„œ: {{ states.sensor | selectattr('entity_id', 'match', '.*power') | selectattr('state', 'ne', 'unavailable') | list | length }}ê°œ
          - ì˜¨ìŠµë„ ì„¼ì„œ: {{ states.sensor | selectattr('entity_id', 'match', '.*temperature|.*humidity') | selectattr('state', 'ne', 'unavailable') | list | length }}ê°œ
          
          ğŸ”´ **ë¬¸ì œ ë°œìƒ:**
          - ì´ unavailable: {{ all_unavailable | length }}ê°œ
          - ì£¼ìš” ë¬¸ì œ: 
          {% if classifications.thinq_fridge | length > 0 %}  ê¹€ì¹˜ëƒ‰ì¥ê³  ({{ classifications.thinq_fridge | length }}) {% endif %}
          {% if classifications.apple_batteries | length > 0 %}  Appleë°°í„°ë¦¬ ({{ classifications.apple_batteries | length }}) {% endif %}
          {% if classifications.ble_sensors | length > 0 %}  BLEì„¼ì„œ ({{ classifications.ble_sensors | length }}) {% endif %}
          
          **ë³µêµ¬ ìŠ¤í¬ë¦½íŠ¸:** ì„¤ì • > ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì‹¤í–‰ ê°€ëŠ¥
        notification_id: system_status_summary
  mode: single

- id: fix_unavailable_entities_recovery
  alias: Fix Unavailable Entities - Automated Recovery
  description: ìë™ìœ¼ë¡œ unavailable ì—”í‹°í‹°ë“¤ì„ ë³µêµ¬í•˜ëŠ” ìë™í™”
  trigger:
    - platform: time_pattern
      minutes: "/30"
    - platform: homeassistant
      event: start
  condition: []
  action:
    - variables:
        unavailable_entities: >-
          {{ states | selectattr('state', 'in', ['unavailable','unknown'])
                     | map(attribute='entity_id') | list }}
        thinq_unavailable: >-
          {{ unavailable_entities | select('match', 'sensor.jubang_.*') | list }}
        ble_unavailable: >-
          {{ unavailable_entities | select('match', '.*ble.*') | list }}
        icloud_unavailable: >-
          {{ unavailable_entities | select('match', '.*battery') | list }}
        xbox_unavailable: >-
          {{ unavailable_entities | select('match', '.*xbox.*') | list }}
    - choose:
        - conditions: "{{ thinq_unavailable | length > 0 }}"
          sequence:
            - service: system_log.write
              data:
                message: >-
                  LG ThinQ unavailable entities detected: {{ thinq_unavailable | join(', ') }}
                  Attempting integration reload...
                level: warning
            - service: homeassistant.reload_config_entry
              target:
                entity_id: "{{ thinq_unavailable }}"
              continue_on_error: true
    - choose:
        - conditions: "{{ ble_unavailable | length > 0 }}"
          sequence:
            - service: system_log.write
              data:
                message: >-
                  BLE unavailable entities detected: {{ ble_unavailable | join(', ') }}
                  May require bluetooth adapter reset
                level: warning
    - choose:
        - conditions: "{{ icloud_unavailable | length > 0 }}"
          sequence:
            - service: system_log.write
              data:
                message: >-
                  Apple device battery sensors unavailable: {{ icloud_unavailable | join(', ') }}
                  Check iCloud3 integration and Mobile App connections
                level: warning
    - choose:
        - conditions: "{{ xbox_unavailable | length > 0 }}"
          sequence:
            - service: system_log.write
              data:
                message: >-
                  Xbox entities remain unavailable: {{ xbox_unavailable | join(', ') }}
                  These will be permanently disabled in next configuration update
                level: info
    - service: persistent_notification.create
      data:
        title: "ìë™ ë³µêµ¬ ì‹œë„ ì™„ë£Œ"
        message: >-
          **ë³µêµ¬ ì‹œë„ ê²°ê³¼:**
          - ThinQ: {{ thinq_unavailable | length }}ê°œ ì—”í‹°í‹°
          - BLE: {{ ble_unavailable | length }}ê°œ ì—”í‹°í‹°  
          - iCloud: {{ icloud_unavailable | length }}ê°œ ì—”í‹°í‹°
          - Xbox: {{ xbox_unavailable | length }}ê°œ ì—”í‹°í‹° (ë¹„í™œì„±í™” ì˜ˆì •)
          
          **ì´ unavailable ì—”í‹°í‹°**: {{ unavailable_entities | length }}ê°œ
          
          ìƒì„¸ ì •ë³´ëŠ” ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.
        notification_id: auto_recovery_status
  mode: single
  max_exceeded: silent

# ===== example.yaml (ì „ë ¥/ê±´ê°•/ê°€ì „) =====
- id: high_power_consumption_alert
  alias: "ë†’ì€ ì „ë ¥ ì†Œë¹„ ì•Œë¦¼"
  description: "ì´ ì „ë ¥ ì†Œë¹„ê°€ ì„ê³„ê°’ì„ ì´ˆê³¼í–ˆì„ ë•Œ ì•Œë¦¼"
  trigger:
    - platform: numeric_state
      entity_id: sensor.total_power_consumption
      above: 500
      for: "00:05:00"
  condition:
    - condition: state
      entity_id: binary_sensor.someone_home
      state: "on"
  action:
    - service: persistent_notification.create
      data:
        title: "âš¡ ì „ë ¥ ì†Œë¹„ ì£¼ì˜"
        message: >
          í˜„ì¬ ì „ë ¥ ì†Œë¹„ëŸ‰ì´ {{ states('sensor.total_power_consumption') }}Wì…ë‹ˆë‹¤.
          ì—ë„ˆì§€ ì ˆì•½ì„ ìœ„í•´ ë¶ˆí•„ìš”í•œ ê¸°ê¸°ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.
        notification_id: high_power_alert

- id: energy_saving_mode
  alias: "ì—ë„ˆì§€ ì ˆì•½ ëª¨ë“œ"
  description: "ì§‘ì— ì•„ë¬´ë„ ì—†ì„ ë•Œ ì—ë„ˆì§€ ì ˆì•½"
  trigger:
    - platform: state
      entity_id: binary_sensor.someone_home
      from: "on"
      to: "off"
      for: "00:30:00"
  action:
    - service: light.turn_off
      target:
        entity_id:
          - light.zigbee_dimmer
          - light.smart_bulb
    - service: persistent_notification.create
      data:
        title: "ğŸ  ì—ë„ˆì§€ ì ˆì•½ ëª¨ë“œ í™œì„±í™”"
        message: "ë¶€ì¬ ì¤‘ì´ë¯€ë¡œ ì¡°ëª…ì„ ìë™ìœ¼ë¡œ êº¼ë‘ì—ˆìŠµë‹ˆë‹¤."

- id: low_battery_device_alert
  alias: "ì €ë°°í„°ë¦¬ ë””ë°”ì´ìŠ¤ ì•Œë¦¼"
  trigger:
    - platform: state
      entity_id: binary_sensor.low_battery_devices
      from: "off"
      to: "on"
  action:
    - service: persistent_notification.create
      data:
        title: "ğŸ”‹ ë°°í„°ë¦¬ ë¶€ì¡± ì£¼ì˜"
        message: >
          ë°°í„°ë¦¬ê°€ ë¶€ì¡±í•œ ë””ë°”ì´ìŠ¤ê°€ ìˆìŠµë‹ˆë‹¤:
          {% set devices = [
            ('Apple Watch', states('sensor.gimuhyeonyi_apple_watch_battery')),
            ('MacBook Pro', states('sensor.gimuhyeonyi_macbook_pro_battery')),
            ('iPad Pro', states('sensor.uhyeonyi_ipad_pro_battery')),
            ('iPhone XS', states('sensor.uhyeonyi_iphone_xs_battery'))
          ] %}
          {% for device, battery in devices %}
          {% if battery|int < 20 %}
          - {{ device }}: {{ battery }}%
          {% endif %}
          {% endfor %}
        notification_id: low_battery_alert

- id: critical_battery_alert
  alias: "ê·¹ì €ë°°í„°ë¦¬ ì•Œë¦¼"
  trigger:
    - platform: numeric_state
      entity_id:
        - sensor.gimuhyeonyi_apple_watch_battery
        - sensor.gimuhyeonyi_macbook_pro_battery
        - sensor.uhyeonyi_ipad_pro_battery
        - sensor.uhyeonyi_iphone_xs_battery
      below: 10
  action:
    - service: persistent_notification.create
      data:
        title: "ğŸš¨ ë°°í„°ë¦¬ ìœ„í—˜ ìˆ˜ì¤€"
        message: >
          {{ trigger.to_state.attributes.friendly_name }}ì˜ ë°°í„°ë¦¬ê°€ {{ trigger.to_state.state }}%ì…ë‹ˆë‹¤. ì¦‰ì‹œ ì¶©ì „í•˜ì„¸ìš”!
        notification_id: "critical_battery_{{ trigger.entity_id.split('.')[1] }}"

- id: evening_brushing_reminder
  alias: "ì €ë… ì–‘ì¹˜ ì•Œë¦¼"
  trigger:
    - platform: time
      at: "22:00:00"
  condition:
    - condition: state
      entity_id: binary_sensor.someone_home
      state: "on"
    - condition: template
      value_template: >
        {{ (now() - states.sensor.smart_series_7000_6f50.last_changed).total_seconds() > 7200 }}
  action:
    - service: persistent_notification.create
      data:
        title: "ğŸª¥ ì–‘ì¹˜ ì•Œë¦¼"
        message: "ìµœê·¼ 2ì‹œê°„ ë™ì•ˆ ì–‘ì¹˜ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤."
        notification_id: brushing_reminder

- id: high_heart_rate_alert
  alias: "ì‹¬ë°•ìˆ˜ ê²½ê³ "
  trigger:
    - platform: numeric_state
      entity_id: sensor.ble_heart_rate_e0e33e6221b5
      above: 120
      for: "00:01:00"
  action:
    - service: persistent_notification.create
      data:
        title: "â¤ï¸ ì‹¬ë°•ìˆ˜ ê²½ê³ "
        message: "ì‹¬ë°•ìˆ˜ê°€ 120bpm ì´ìƒìœ¼ë¡œ ìƒìŠ¹í–ˆìŠµë‹ˆë‹¤. ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”."
        notification_id: heart_rate_alert

- id: daily_steps_goal_achievement
  alias: "ì¼ì¼ ê±¸ìŒìˆ˜ ëª©í‘œ ë‹¬ì„±"
  trigger:
    - platform: numeric_state
      entity_id: sensor.ble_steps_e0e33e6221b5
      above: 10000
  condition:
    - condition: template
      value_template: >
        {{ (now().date() - states.sensor.ble_steps_e0e33e6221b5.last_changed.date()).days == 0 }}
  action:
    - service: persistent_notification.create
      data:
        title: "ğŸ‰ ê±¸ìŒìˆ˜ ëª©í‘œ ë‹¬ì„±!"
        message: >
          ì¶•í•˜í•©ë‹ˆë‹¤! ì˜¤ëŠ˜ {{ states('sensor.ble_steps_e0e33e6221b5') }}ë³´ë¥¼ ê±¸ìœ¼ì…¨ë„¤ìš”.
          ê±´ê°•í•œ í•˜ë£¨ë¥¼ ë³´ë‚´ê³  ê³„ì‹œëŠ”êµ°ìš”! ğŸ‘
        notification_id: steps_goal_achieved

- id: kimchi_fridge_temperature_alert
  alias: "ê¹€ì¹˜ëƒ‰ì¥ê³  ì˜¨ë„ ì´ìƒ"
  trigger:
    - platform: numeric_state
      entity_id: sensor.kimchi_fridge_avg_temperature
      above: 5
      for: "00:30:00"
    - platform: numeric_state
      entity_id: sensor.kimchi_fridge_avg_temperature
      below: -5
      for: "00:30:00"
  action:
    - service: persistent_notification.create
      data:
        title: "ğŸ¥¬ ê¹€ì¹˜ëƒ‰ì¥ê³  ì˜¨ë„ ì£¼ì˜"
        message: >
          ê¹€ì¹˜ëƒ‰ì¥ê³  í‰ê·  ì˜¨ë„ê°€ {{ states('sensor.kimchi_fridge_avg_temperature') }}Â°Cì…ë‹ˆë‹¤.
          ì ì • ì˜¨ë„ ë²”ìœ„(-5Â°C ~ 5Â°C)ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.
        notification_id: kimchi_fridge_temp_alert

- id: dishwasher_cycle_complete
  alias: "ì‹ê¸°ì„¸ì²™ê¸° ì™„ë£Œ ì•Œë¦¼"
  trigger:
    - platform: state
      entity_id: sensor.jubang_siggiseceoggi_remaining_time
      to: "0"
  condition:
    - condition: state
      entity_id: binary_sensor.someone_home
      state: "on"
  action:
    - service: persistent_notification.create
      data:
        title: "ğŸ½ï¸ ì‹ê¸°ì„¸ì²™ê¸° ì™„ë£Œ"
        message: >
          ì‹ê¸°ì„¸ì²™ê¸° ì„¸ì²™ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! 
          ì‹ê¸°ë¥¼ êº¼ë‚´ì£¼ì„¸ìš”. ì´ ì„¸ì²™ ì‹œê°„: {{ states('sensor.jubang_siggiseceoggi_total_time') }}
        notification_id: dishwasher_complete

- id: rinse_aid_refill_reminder
  alias: "ë¦°ìŠ¤ ë³´ì¶© ì•Œë¦¼"
  trigger:
    - platform: state
      entity_id: binary_sensor.jubang_siggiseceoggi_rinse_refill_needed
      from: "off"
      to: "on"
  action:
    - service: persistent_notification.create
      data:
        title: "ğŸ§´ ë¦°ìŠ¤ ë³´ì¶© í•„ìš”"
        message: >
          ì‹ê¸°ì„¸ì²™ê¸° ë¦°ìŠ¤ ë³´ì¶©ì´ í•„ìš”í•©ë‹ˆë‹¤. 
          í˜„ì¬ ì”ì—¬ëŸ‰: {{ states('sensor.jubang_siggiseceoggi_rinse_aid_dispenser_level') }}
        notification_id: rinse_aid_reminder

# ===== ios_theme_switch.yaml (HVAC/ì‹œê°„/í…Œë§ˆ) =====
- id: smart_ac_temperature_control
  alias: "ìŠ¤ë§ˆíŠ¸ ì—ì–´ì»¨ ì˜¨ë„ ì œì–´"
  trigger:
    - platform: numeric_state
      entity_id: sensor.seutaendeuhyeong_eeokeon_temperature
      above: 28
      for: "00:10:00"
    - platform: numeric_state
      entity_id: sensor.seutaendeuhyeong_eeokeon_temperature
      below: 22
      for: "00:10:00"
  condition:
    - condition: state
      entity_id: binary_sensor.someone_home
      state: "on"
    - condition: state
      entity_id: binary_sensor.workday_sensor
      state: "on"
  action:
    - choose:
        - conditions:
            - condition: numeric_state
              entity_id: sensor.seutaendeuhyeong_eeokeon_temperature
              above: 28
          sequence:
            - service: climate.set_temperature
              target:
                entity_id: climate.seutaendeuhyeong_eeokeon
              data:
                temperature: 24
                hvac_mode: "cool"
            - service: persistent_notification.create
              data:
                title: "â„ï¸ ì—ì–´ì»¨ ëƒ‰ë°© ìë™ ì‹œì‘"
                message: "ì‹¤ë‚´ ì˜¨ë„ê°€ {{ states('sensor.seutaendeuhyeong_eeokeon_temperature') }}Â°Cë¡œ ë†’ì•„ì ¸ì„œ ëƒ‰ë°©ì„ ì‹œì‘í–ˆìŠµë‹ˆë‹¤."
        - conditions:
            - condition: numeric_state
              entity_id: sensor.seutaendeuhyeong_eeokeon_temperature
              below: 22
          sequence:
            - service: climate.turn_off
              target:
                entity_id: climate.seutaendeuhyeong_eeokeon
            - service: persistent_notification.create
              data:
                title: "ğŸŒ¡ï¸ ì—ì–´ì»¨ ìë™ ì •ì§€"
                message: "ì‹¤ë‚´ ì˜¨ë„ê°€ {{ states('sensor.seutaendeuhyeong_eeokeon_temperature') }}Â°Cë¡œ ì ì •í•´ì ¸ì„œ ì—ì–´ì»¨ì„ ê»ìŠµë‹ˆë‹¤."

- id: humidity_management_alert
  alias: "ìŠµë„ ê´€ë¦¬ ì•Œë¦¼"
  trigger:
    - platform: numeric_state
      entity_id: sensor.seutaendeuhyeong_eeokeon_humidity
      above: 70
      for: "00:30:00"
    - platform: numeric_state
      entity_id: sensor.seutaendeuhyeong_eeokeon_humidity
      below: 30
      for: "00:30:00"
  action:
    - service: persistent_notification.create
      data:
        title: "ğŸ’§ ìŠµë„ ê´€ë¦¬ í•„ìš”"
        message: >
          í˜„ì¬ ìŠµë„ê°€ {{ states('sensor.seutaendeuhyeong_eeokeon_humidity') }}%ì…ë‹ˆë‹¤.
          {% if trigger.above is defined %}
          ìŠµë„ê°€ ë†’ìŠµë‹ˆë‹¤. ì œìŠµì„ ê³ ë ¤í•´ë³´ì„¸ìš”.
          {% else %}
          ìŠµë„ê°€ ë‚®ìŠµë‹ˆë‹¤. ê°€ìŠµì„ ê³ ë ¤í•´ë³´ì„¸ìš”.
          {% endif %}
        notification_id: humidity_alert

- id: sunrise_gradual_lighting
  alias: "ì¼ì¶œ ì¡°ëª… ì„œì„œíˆ ì¼œê¸°"
  trigger:
    - platform: sun
      event: sunrise
      offset: "-00:30:00"
  condition:
    - condition: state
      entity_id: binary_sensor.someone_home
      state: "on"
    - condition: state
      entity_id: binary_sensor.workday_sensor
      state: "on"
  action:
    - service: light.turn_on
      target:
        entity_id: light.zigbee_dimmer
      data:
        brightness_pct: 10
        transition: 300
    - delay: "00:15:00"
    - service: light.turn_on
      target:
        entity_id: light.zigbee_dimmer
      data:
        brightness_pct: 50
        transition: 900

- id: sunset_auto_lighting
  alias: "ì¼ëª° í›„ ìë™ ì¡°ëª…"
  trigger:
    - platform: sun
      event: sunset
      offset: "00:30:00"
  condition:
    - condition: state
      entity_id: binary_sensor.someone_home
      state: "on"
  action:
    - service: light.turn_on
      target:
        entity_id:
          - light.zigbee_dimmer
          - light.smart_bulb
      data:
        brightness_pct: 80
        color_temp_kelvin: 2500

- id: bedtime_lights_off
  alias: "ì·¨ì¹¨ ì‹œê°„ ì¡°ëª… ë„ê¸°"
  trigger:
    - platform: time
      at: "23:30:00"
  condition:
    - condition: state
      entity_id: binary_sensor.someone_home
      state: "on"
  action:
    - service: light.turn_on
      target:
        entity_id:
          - light.zigbee_dimmer
          - light.smart_bulb
      data:
        brightness_pct: 20
        transition: 300
    - delay: "00:05:00"
    - service: light.turn_off
      target:
        entity_id:
          - light.zigbee_dimmer
          - light.smart_bulb
    - service: persistent_notification.create
      data:
        title: "ğŸŒ™ ì¢‹ì€ ê¿ˆ ë˜ì„¸ìš”"
        message: "ì·¨ì¹¨ ì‹œê°„ì´ë¼ ì¡°ëª…ì„ ê»ìŠµë‹ˆë‹¤. ì¢‹ì€ ë°¤ ë³´ë‚´ì„¸ìš”!"
        notification_id: bedtime_lights

- id: workday_morning_briefing
  alias: "ê·¼ë¬´ì¼ ì•„ì¹¨ ë¸Œë¦¬í•‘"
  trigger:
    - platform: time
      at: "07:30:00"
  condition:
    - condition: state
      entity_id: binary_sensor.workday_sensor
      state: "on"
    - condition: state
      entity_id: binary_sensor.someone_home
      state: "on"
  action:
    - service: persistent_notification.create
      data:
        title: "â˜€ï¸ ì¢‹ì€ ì•„ì¹¨ì…ë‹ˆë‹¤!"
        message: >
          ì˜¤ëŠ˜ì˜ ì •ë³´ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”:
          
          ğŸ“… {{ states('sensor.date') }}
          ğŸŒ¡ï¸ ì‹¤ë‚´ ì˜¨ë„: {{ states('sensor.seutaendeuhyeong_eeokeon_temperature') }}Â°C
          ğŸ’§ ì‹¤ë‚´ ìŠµë„: {{ states('sensor.seutaendeuhyeong_eeokeon_humidity') }}%
          âš¡ í˜„ì¬ ì „ë ¥: {{ states('sensor.total_power_consumption') }}W
          ğŸ”‹ í‰ê·  ë°°í„°ë¦¬: {{ states('sensor.average_device_battery') }}%
          
          ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”! ğŸ’ª
        notification_id: morning_briefing

- id: weekend_sleep_mode
  alias: "ì£¼ë§ ëŠ¦ì  ëª¨ë“œ"
  trigger:
    - platform: sun
      event: sunrise
      offset: "02:00:00"
  condition:
    - condition: state
      entity_id: binary_sensor.workday_sensor
      state: "off"
    - condition: state
      entity_id: binary_sensor.someone_home
      state: "on"
  action:
    - service: light.turn_on
      target:
        entity_id: light.zigbee_dimmer
      data:
        brightness_pct: 30
        transition: 600
    - service: persistent_notification.create
      data:
        title: "ğŸ˜´ ì£¼ë§ ëª¨ë“œ"
        message: "ì£¼ë§ì´ë‹ˆê¹Œ ì²œì²œíˆ ì¼ì–´ë‚˜ì„¸ìš”. ì¡°ëª…ì„ ë¶€ë“œëŸ½ê²Œ ì¼°ìŠµë‹ˆë‹¤."
        notification_id: weekend_mode

- id: weekly_system_report
  alias: "ì£¼ê°„ ì‹œìŠ¤í…œ ë¦¬í¬íŠ¸"
  trigger:
    - platform: time
      at: "20:00:00"
  condition:
    - condition: time
      weekday:
        - sun
  action:
    - service: persistent_notification.create
      data:
        title: "ğŸ“Š ì£¼ê°„ ì‹œìŠ¤í…œ ë¦¬í¬íŠ¸"
        message: >
          ì´ë²ˆ ì£¼ ì‹œìŠ¤í…œ ìƒíƒœ ìš”ì•½:
          
          ğŸ  ì‹œìŠ¤í…œ ê°€ë™ì‹œê°„: {{ states('sensor.last_boot') }}
          ğŸ’» í‰ê·  CPU ì‚¬ìš©ë¥ : {{ states('sensor.processor_use') }}%
          ğŸ’¾ ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ : {{ states('sensor.memory_use_percent') }}%
          ğŸ’½ ë””ìŠ¤í¬ ì‚¬ìš©ë¥ : {{ states('sensor.disk_use_percent') }}%
          ğŸŒ ë„¤íŠ¸ì›Œí¬ ì—°ê²° ê¸°ê¸°: {{ states('sensor.192_168_1_1_devices_connected') }}ê°œ
          
          ëª¨ë“  ì‹œìŠ¤í…œì´ ì •ìƒ ì‘ë™ ì¤‘ì…ë‹ˆë‹¤! ğŸ‘
        notification_id: weekly_report

- id: ios_theme_dark_sunset
  alias: "iOS í…Œë§ˆ ë‹¤í¬ëª¨ë“œ (ì¼ëª°)"
  trigger:
    - platform: sun
      event: sunset
  action:
    - service: frontend.set_theme
      data:
        name: "ios-dark-mode"

- id: ios_theme_light_sunrise
  alias: "iOS í…Œë§ˆ ë¼ì´íŠ¸ëª¨ë“œ (ì¼ì¶œ)"
  trigger:
    - platform: sun
      event: sunrise
  action:
    - service: frontend.set_theme
      data:
        name: "ios-light-mode"
