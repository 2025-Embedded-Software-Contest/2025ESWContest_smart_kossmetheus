- id: fall_trigger_auto_reset
  alias: ë‚™ìƒ ê°ì§€ ìƒíƒœ ìë™ ë³µêµ¬
  description: input_boolean.fall_triggeredê°€ ONìœ¼ë¡œ ë°”ë€Œë©´ ì¼ì • ì‹œê°„ í›„ ìë™ìœ¼ë¡œ OFFë¡œ ë³µêµ¬
  trigger:
    - trigger: state
      entity_id: input_boolean.fall_triggered
      to: "on"
      for: 00:00:30
  condition:
    - condition: template
      value_template: "{{ not is_state('sensor.uptime', '0') }}"
  action:
    - action: input_boolean.turn_off
      target:
        entity_id: input_boolean.fall_triggered
  mode: single
- id: high_power_consumption_alert
  alias: ë†’ì€ ì „ë ¥ ì†Œë¹„ ì•Œë¦¼
  description: ì´ ì „ë ¥ ì†Œë¹„ê°€ ì„ê³„ê°’ì„ ì´ˆê³¼í–ˆì„ ë•Œ ì•Œë¦¼
  trigger:
    - trigger: numeric_state
      entity_id: sensor.total_power_consumption
      above: 500
      for: 00:05:00
  condition:
    - condition: state
      entity_id: binary_sensor.someone_home
      state: "on"
  action:
    - action: persistent_notification.create
      data:
        title: âš¡ ì „ë ¥ ì†Œë¹„ ì£¼ì˜
        message:
          "í˜„ì¬ ì „ë ¥ ì†Œë¹„ëŸ‰ì´ {{ states('sensor.total_power_consumption') }}Wì…ë‹ˆë‹¤. ì—ë„ˆì§€
          ì ˆì•½ì„ ìœ„í•´ ë¶ˆí•„ìš”í•œ ê¸°ê¸°ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.

          "
        notification_id: high_power_alert
- id: energy_saving_mode
  alias: ì—ë„ˆì§€ ì ˆì•½ ëª¨ë“œ
  description: ì§‘ì— ì•„ë¬´ë„ ì—†ì„ ë•Œ ì—ë„ˆì§€ ì ˆì•½
  trigger:
    - trigger: state
      entity_id: binary_sensor.someone_home
      from: "on"
      to: "off"
      for: 00:30:00
  action:
    - action: light.turn_off
      target:
        entity_id:
          - light.zigbee_dimmer
          - light.smart_bulb
    - action: persistent_notification.create
      data:
        title: "\U0001F3E0 ì—ë„ˆì§€ ì ˆì•½ ëª¨ë“œ í™œì„±í™”"
        message: ë¶€ì¬ ì¤‘ì´ë¯€ë¡œ ì¡°ëª…ì„ ìë™ìœ¼ë¡œ êº¼ë‘ì—ˆìŠµë‹ˆë‹¤.
- id: low_battery_device_alert
  alias: ì €ë°°í„°ë¦¬ ë””ë°”ì´ìŠ¤ ì•Œë¦¼
  trigger:
    - trigger: state
      entity_id: binary_sensor.low_battery_devices
      from: "off"
      to: "on"
  action:
    - action: persistent_notification.create
      data:
        title: "\U0001F50B ë°°í„°ë¦¬ ë¶€ì¡± ì£¼ì˜"
        message:
          "ë°°í„°ë¦¬ê°€ ë¶€ì¡±í•œ ë””ë°”ì´ìŠ¤ê°€ ìˆìŠµë‹ˆë‹¤: {% set devices = [\n  ('Apple Watch', states('sensor.gimuhyeonyi_apple_watch_battery')),\n
          \ ('MacBook Pro', states('sensor.gimuhyeonyi_macbook_pro_battery')),\n  ('iPad
          Pro', states('sensor.uhyeonyi_ipad_pro_battery')),\n  ('iPhone 17 Pro', states('sensor.iphone_battery_level'))\n]
          %} {% for device, battery in devices %} {% if battery|int < 20 %} - {{ device
          }}: {{ battery }}% {% endif %} {% endfor %}\n"
        notification_id: low_battery_alert
- id: critical_battery_alert
  alias: ê·¹ì €ë°°í„°ë¦¬ ì•Œë¦¼
  trigger:
    - trigger: numeric_state
      entity_id:
        - sensor.gimuhyeonyi_apple_watch_battery
        - sensor.gimuhyeonyi_macbook_pro_battery
        - sensor.uhyeonyi_ipad_pro_battery
        - sensor.iphone_battery_level
      below: 10
  action:
    - action: persistent_notification.create
      data:
        title: "\U0001F6A8 ë°°í„°ë¦¬ ìœ„í—˜ ìˆ˜ì¤€"
        message:
          "{{ trigger.to_state.attributes.friendly_name }}ì˜ ë°°í„°ë¦¬ê°€ {{ trigger.to_state.state
          }}%ì…ë‹ˆë‹¤. ì¦‰ì‹œ ì¶©ì „í•˜ì„¸ìš”!

          "
        notification_id: critical_battery_{{ trigger.entity_id.split('.')[1] }}
- id: evening_brushing_reminder
  alias: ì €ë… ì–‘ì¹˜ ì•Œë¦¼
  trigger:
    - trigger: time
      at: "22:00:00"
  condition:
    - condition: state
      entity_id: binary_sensor.someone_home
      state: "on"
    - condition: template
      value_template:
        "{{ (now() - states.sensor.smart_series_7000_6f50.last_changed).total_seconds()
        > 7200 }}

        "
  action:
    - action: persistent_notification.create
      data:
        title: "\U0001FAA5 ì–‘ì¹˜ ì•Œë¦¼"
        message: ìµœê·¼ 2ì‹œê°„ ë™ì•ˆ ì–‘ì¹˜ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.
        notification_id: brushing_reminder
- id: high_heart_rate_alert
  alias: ì‹¬ë°•ìˆ˜ ê²½ê³ 
  trigger:
    - trigger: numeric_state
      entity_id: sensor.ble_heart_rate_e0e33e6221b5
      above: 120
      for: 00:01:00
  action:
    - action: persistent_notification.create
      data:
        title: â¤ï¸ ì‹¬ë°•ìˆ˜ ê²½ê³ 
        message: ì‹¬ë°•ìˆ˜ê°€ 120bpm ì´ìƒìœ¼ë¡œ ìƒìŠ¹í–ˆìŠµë‹ˆë‹¤. ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.
        notification_id: heart_rate_alert
- id: daily_steps_goal_achievement
  alias: ì¼ì¼ ê±¸ìŒìˆ˜ ëª©í‘œ ë‹¬ì„±
  trigger:
    - trigger: numeric_state
      entity_id: sensor.ble_steps_e0e33e6221b5
      above: 10000
  condition:
    - condition: template
      value_template:
        "{{ (now().date() - states.sensor.ble_steps_e0e33e6221b5.last_changed.date()).days
        == 0 }}

        "
  action:
    - action: persistent_notification.create
      data:
        title: "\U0001F389 ê±¸ìŒìˆ˜ ëª©í‘œ ë‹¬ì„±!"
        message:
          "ì¶•í•˜í•©ë‹ˆë‹¤! ì˜¤ëŠ˜ {{ states('sensor.ble_steps_e0e33e6221b5') }}ë³´ë¥¼ ê±¸ìœ¼ì…¨ë„¤ìš”. ê±´ê°•í•œ
          í•˜ë£¨ë¥¼ ë³´ë‚´ê³  ê³„ì‹œëŠ”êµ°ìš”! \U0001F44F\n"
        notification_id: steps_goal_achieved
- id: dishwasher_cycle_complete
  alias: ì‹ê¸°ì„¸ì²™ê¸° ì™„ë£Œ ì•Œë¦¼
  trigger:
    - trigger: state
      entity_id: sensor.jubang_siggiseceoggi_remaining_time
      to: "0"
  condition:
    - condition: state
      entity_id: binary_sensor.someone_home
      state: "on"
  action:
    - action: persistent_notification.create
      data:
        title: "\U0001F37Dï¸ ì‹ê¸°ì„¸ì²™ê¸° ì™„ë£Œ"
        message:
          "ì‹ê¸°ì„¸ì²™ê¸° ì„¸ì²™ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!  ì‹ê¸°ë¥¼ êº¼ë‚´ì£¼ì„¸ìš”. ì´ ì„¸ì²™ ì‹œê°„: {{ states('sensor.jubang_siggiseceoggi_total_time')
          }}

          "
        notification_id: dishwasher_complete
- id: humidity_management_alert
  alias: ìŠµë„ ê´€ë¦¬ ì•Œë¦¼
  trigger:
    - trigger: numeric_state
      entity_id: sensor.seutaendeuhyeong_eeokeon_humidity
      above: 70
      for: 00:30:00
    - trigger: numeric_state
      entity_id: sensor.seutaendeuhyeong_eeokeon_humidity
      below: 30
      for: 00:30:00
  action:
    - action: persistent_notification.create
      data:
        title: "\U0001F4A7 ìŠµë„ ê´€ë¦¬ í•„ìš”"
        message:
          "í˜„ì¬ ìŠµë„ê°€ {{ states('sensor.seutaendeuhyeong_eeokeon_humidity') }}%ì…ë‹ˆë‹¤.
          {% if trigger.platform == 'numeric_state' and trigger.above is not none %}\n
          \ ìŠµë„ê°€ ë†’ìŠµë‹ˆë‹¤. ì œìŠµì„ ê³ ë ¤í•´ë³´ì„¸ìš”.\n{% else %}\n  ìŠµë„ê°€ ë‚®ìŠµë‹ˆë‹¤. ê°€ìŠµì„ ê³ ë ¤í•´ë³´ì„¸ìš”.\n{% endif %}\n"
        notification_id: humidity_alert
- id: sunrise_gradual_lighting
  alias: ì¼ì¶œ ì¡°ëª… ì„œì„œíˆ ì¼œê¸°
  trigger:
    - trigger: sun
      event: sunrise
      offset: -00:30:00
  condition:
    - condition: state
      entity_id: binary_sensor.someone_home
      state: "on"
    - condition: state
      entity_id: binary_sensor.workday_sensor
      state: "on"
  action:
    - action: light.turn_on
      target:
        entity_id: light.zigbee_dimmer
      data:
        brightness_pct: 10
        transition: 300
    - delay: 00:15:00
    - action: light.turn_on
      target:
        entity_id: light.zigbee_dimmer
      data:
        brightness_pct: 50
        transition: 900
- id: sunset_auto_lighting
  alias: ì¼ëª° í›„ ìë™ ì¡°ëª…
  trigger:
    - trigger: sun
      event: sunset
      offset: 00:30:00
  condition:
    - condition: state
      entity_id: binary_sensor.someone_home
      state: "on"
  action:
    - action: light.turn_on
      target:
        entity_id:
          - light.zigbee_dimmer
          - light.smart_bulb
      data:
        brightness_pct: 80
        color_temp_kelvin: 2500
- id: bedtime_lights_off
  alias: ì·¨ì¹¨ ì‹œê°„ ì¡°ëª… ë„ê¸°
  trigger:
    - trigger: time
      at: "23:30:00"
  condition:
    - condition: state
      entity_id: binary_sensor.someone_home
      state: "on"
  action:
    - action: light.turn_on
      target:
        entity_id:
          - light.zigbee_dimmer
          - light.smart_bulb
      data:
        brightness_pct: 20
        transition: 300
    - delay: 00:05:00
    - action: light.turn_off
      target:
        entity_id:
          - light.zigbee_dimmer
          - light.smart_bulb
    - action: persistent_notification.create
      data:
        title: "\U0001F319 ì¢‹ì€ ê¿ˆ ë˜ì„¸ìš”"
        message: ì·¨ì¹¨ ì‹œê°„ì´ë¼ ì¡°ëª…ì„ ê»ìŠµë‹ˆë‹¤. ì¢‹ì€ ë°¤ ë³´ë‚´ì„¸ìš”!
        notification_id: bedtime_lights
- id: workday_morning_briefing
  alias: ê·¼ë¬´ì¼ ì•„ì¹¨ ë¸Œë¦¬í•‘
  trigger:
    - trigger: time
      at: 07:30:00
  condition:
    - condition: state
      entity_id: binary_sensor.workday_sensor
      state: "on"
    - condition: state
      entity_id: binary_sensor.someone_home
      state: "on"
  action:
    - action: persistent_notification.create
      data:
        title: â˜€ï¸ ì¢‹ì€ ì•„ì¹¨ì…ë‹ˆë‹¤!
        message:
          "ì˜¤ëŠ˜ì˜ ì •ë³´ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”:\n\U0001F4C5 {{ states('sensor.date') }} \U0001F321ï¸
          ì‹¤ë‚´ ì˜¨ë„: {{ states('sensor.seutaendeuhyeong_eeokeon_temperature') }}Â°C \U0001F4A7
          ì‹¤ë‚´ ìŠµë„: {{ states('sensor.seutaendeuhyeong_eeokeon_humidity') }}% âš¡ í˜„ì¬ ì „ë ¥:
          {{ states('sensor.total_power_consumption') }}W \U0001F50B í‰ê·  ë°°í„°ë¦¬: {{ states('sensor.average_device_battery')
          }}%\nì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”! \U0001F4AA\n"
        notification_id: morning_briefing
- id: weekend_sleep_mode
  alias: ì£¼ë§ ëŠ¦ì  ëª¨ë“œ
  trigger:
    - trigger: sun
      event: sunrise
      offset: 02:00:00
  condition:
    - condition: state
      entity_id: binary_sensor.workday_sensor
      state: "off"
    - condition: state
      entity_id: binary_sensor.someone_home
      state: "on"
  action:
    - action: light.turn_on
      target:
        entity_id: light.zigbee_dimmer
      data:
        brightness_pct: 30
        transition: 600
    - action: persistent_notification.create
      data:
        title: "\U0001F634 ì£¼ë§ ëª¨ë“œ"
        message: ì£¼ë§ì´ë‹ˆê¹Œ ì²œì²œíˆ ì¼ì–´ë‚˜ì„¸ìš”. ì¡°ëª…ì„ ë¶€ë“œëŸ½ê²Œ ì¼°ìŠµë‹ˆë‹¤.
        notification_id: weekend_mode
- id: gas_send_monthly_telegram
  alias: ê°€ìŠ¤ ê²€ì¹¨ ì‚¬ì§„ ë³´ë‚´ê¸°
  description: ""
  trigger:
    - at: 09:03:00
      trigger: time
  condition:
    - condition: template
      value_template: "{{now().day == 26}}"
  action:
    - variables:
        nowdate: "{{ now().strftime('%Y-%m-%d') }}"
        nowtime: "{{ now().strftime('%Y-%m-%d_%H:%M:%S') }}"
        nowtimefile: "{{ now().strftime('%Y%m%d_%H%M%S') }}"
        nowtimestamp: "{{ now().timestamp() }}"
    - action: pyscript.image_rotate
      metadata: {}
      data:
        input_image: /config/www/tmp/gas/gas_latest.jpg
        output_image: /config/www/tmp/gas/month/gas_{{nowtimefile}}.jpg
        rotation_angle: 0
    - action: notify.telegram_home
      data:
        title: ê°€ìŠ¤ ê²€ì¹¨ ì•Œë¦¼
        message: "ê²€ì¹¨ì‹œê°„: {{nowdate}}"
        data:
          photo:
            - url: https://ha.aaaa.cc/local/tmp/gas/gas_latest.jpg
              caption: "ê°€ìŠ¤ ê²€ì¹¨ì¼: {{nowdate}}

                ê°€ìŠ¤ ê²€ì¹¨: {{states('sensor.gas_meter_2')}}

                ì›”ê°„ ì‚¬ìš©ëŸ‰: {{state_attr('sensor.gas_meter_monthly','last_period')}}"
      enabled: false
  mode: single
- id: "1755698295141"
  alias: ì£¼ë³€ ë°ê¸° ìë™ ì¡°ëª… ì œì–´
  description: ì£¼ë³€ ë°ê¸°ê°€ ì¶©ë¶„í•  ë•Œ ìë™ìœ¼ë¡œ ì¡°ëª…ì„ ë•ë‹ˆë‹¤.
  trigger:
    - type: illuminance
      device_id: e28ebb70ec49039d225e74b202fdd91e
      entity_id: 4ff6ecbace5417823e81b823fd5bd60e
      domain: sensor
      trigger: device
      below: 20
  condition: []
  action:
    - type: turn_off
      device_id: 16c454176737aa10fa53bf309f24d111
      entity_id: f88477c68d783968908c54499f788206
      domain: light
  mode: single
- id: "1755744715659"
  alias: ë‚®ì€ ì„ê³„ê°’ ì¡°ëª… ì•Œë¦¼
  description: íŠ¹ì • ì„¼ì„œ ê°’ì´ ì„ê³„ê°’ ë¯¸ë§Œìœ¼ë¡œ ë–¨ì–´ì§ˆ ë•Œ ì¡°ëª…ì„ ì¼œì„œ ì‹œê°ì ìœ¼ë¡œ ì•Œë¦½ë‹ˆë‹¤.
  trigger:
    - type: value
      device_id: 42940cb04959837ed39a637fed0f69e2
      entity_id: 64ba2d64e316df06c349b58054dcab48
      domain: sensor
      trigger: device
      below: 2
  condition: []
  action:
    - type: turn_on
      device_id: 16c454176737aa10fa53bf309f24d111
      entity_id: f88477c68d783968908c54499f788206
      domain: light
      brightness_pct: 100
  mode: single
- id: "1759067786798"
  alias: ì´ì‚°í™”íƒ„ì†Œ ìë™ í™˜ê¸° ì œì–´
  description: ì‹¤ë‚´ ì´ì‚°í™”íƒ„ì†Œ ë†ë„ê°€ ë†’ì•„ì§€ë©´ í™˜ê¸° ì‹œìŠ¤í…œì„ ìë™ìœ¼ë¡œ ì¼­ë‹ˆë‹¤.
  trigger:
    - trigger: state
      entity_id:
        - binary_sensor.ventilation_should_run
      attribute: ì¼œì§
  condition:
    - condition: device
      type: is_off
      device_id: 98bda3e8ced3d5a12ee685841e367c15
      entity_id: 99f72fc2d843060f243cb0f5979fe38d
      domain: switch
  action:
    - type: turn_on
      device_id: 98bda3e8ced3d5a12ee685841e367c15
      entity_id: 99f72fc2d843060f243cb0f5979fe38d
      domain: switch
    - repeat:
        count: 12
        sequence:
          - type: toggle
            device_id: 98bda3e8ced3d5a12ee685841e367c15
            entity_id: 08a45393493c019ceb1c55783651f7e1
            domain: switch
          - delay:
              hours: 0
              minutes: 0
              seconds: 1
              milliseconds: 0
      enabled: false
  mode: single
- id: "1759068039218"
  alias: ì´ì‚°í™”íƒ„ì†Œ ìë™ í™˜ê¸° í•˜í–¥
  description: ì‹¤ë‚´ ì´ì‚°í™”íƒ„ì†Œ ë†ë„ê°€ ê¸°ì¤€ì¹˜ ì´í•˜ë¡œ ë–¨ì–´ì§€ë©´ í™˜ê¸° ì‹œìŠ¤í…œì„ ìë™ìœ¼ë¡œ ë•ë‹ˆë‹¤.
  trigger:
    - trigger: state
      entity_id:
        - binary_sensor.ventilation_should_run
      attribute: êº¼ì§
  condition:
    - condition: device
      type: is_on
      device_id: 98bda3e8ced3d5a12ee685841e367c15
      entity_id: 99f72fc2d843060f243cb0f5979fe38d
      domain: switch
  action:
    - type: turn_off
      device_id: 98bda3e8ced3d5a12ee685841e367c15
      entity_id: 99f72fc2d843060f243cb0f5979fe38d
      domain: switch
  mode: single
- id: "1759395712039"
  alias: ë…¹ìŒë³¸ ì €ì¥ ì‹œ ë¡œì»¬ ë§¥ìœ¼ë¡œ ë³µì‚¬
  description: ""
  trigger:
    - event_type: voice_recorder_saved
      trigger: event
  action:
    - data:
        url:
          "{{ 'https://caredian.gleeze.com' ~ (trigger.event.data.path | replace('/config/www','/local'))
          }}"
        filename: "{{ trigger.event.data.filename }}"
      action: rest_command.push_record_to_mac
  mode: queued
- id: "1759500010000"
  alias: ê°€ìŠ¤ ê²€ì¹¨ ë‹¨ì¼ í”„ë¡¬í”„íŠ¸
  description: í•˜ë‚˜ì˜ í¬ë¡­ ì´ë¯¸ì§€ì—ì„œ í”„ë¡¬í”„íŠ¸ë§Œìœ¼ë¡œ 7ìë¦¬(DDD.dddd) íŒë…
  trigger:
    - trigger: time_pattern
      hours: /1
  condition: []
  action:
    - metadata: {}
      data:
        rgb_color:
          - 255
          - 255
          - 255
        brightness_pct: 35
      target:
        entity_id: light.esp32_cam_esp32_cam_gas_light
      action: light.turn_on
    - delay:
        hours: 0
        minutes: 0
        seconds: 6
        milliseconds: 0
    - metadata: {}
      data:
        filename: /config/www/tmp/gas/gas_latest.jpg
      action: camera.snapshot
      target:
        entity_id: camera.esp32_cam_esp32_cam_gas_cam
    - alias: í¬ë¡­ë§Œ ìˆ˜í–‰(ë¦¬ì‚¬ì´ì¦ˆ ë¯¸ì‚¬ìš©)
      action: pyscript.gas_ocr_prepare
      data:
        input_image: /config/www/tmp/gas/gas_latest.jpg
        crop_output: /config/www/tmp/gas/gas_latest-crop.jpg
        resize_output: /config/www/tmp/gas/gas_latest-crop-resize.jpg
        int_output: /config/www/tmp/gas/gas_latest-crop-resize1.jpg
        frac_output: /config/www/tmp/gas/gas_latest-crop-resize2.jpg
        crop_left: 420
        crop_top: 720
        crop_right: 1220
        crop_bottom: 880
        resize_width: 0
        to_grayscale: true
        denoise_median_size: 3
        auto_vertical: true
        vpad: 2
        hpad: 2
    - metadata: {}
      data: {}
      target:
        entity_id: light.esp32_cam_esp32_cam_gas_light
      action: light.turn_off
    - action: ai_task.generate_data
      response_variable: res
      data:
        task_name: ê°€ìŠ¤ ê²€ì¹¨ ë‹¨ì¼ í”„ë¡¬í”„íŠ¸
        instructions:
          ì´ ì´ë¯¸ì§€ëŠ” ê¸°ê³„ì‹ ê°€ìŠ¤ ê³„ëŸ‰ê¸°ì˜ 7ìë¦¬ ìˆ«ì í‘œì‹œë¶€ì…ë‹ˆë‹¤. 3ìë¦¬ ì •ìˆ˜ë¶€ì™€ 4ìë¦¬ ì†Œìˆ˜ë¶€ë¥¼ ì½ê³ , ìˆ«ìë§Œìœ¼ë¡œ
          DDD.dddd í˜•ì‹ìœ¼ë¡œ ë°˜í™˜í•˜ì„¸ìš”. ê³µë°±Â·ë‹¨ìœ„Â·ì„¤ëª…Â·ì¤„ë°”ê¿ˆ ì—†ì´ ê²°ê³¼ë§Œ ì¶œë ¥í•˜ì„¸ìš”.
        attachments:
          media_content_id: media-source://media_source/gas/gas_latest.jpg
          media_content_type: image/jpeg
          metadata:
            title: gas_latest.jpg
            thumbnail:
            media_class: image
            children_media_class:
            navigateIds:
              - {}
              - media_content_type: app
                media_content_id: media-source://media_source
              - media_content_type: ""
                media_content_id: media-source://media_source/gas/.
        entity_id: ai_task.qwen_qwen2_5_vl_72b_instruct_free
    - variables:
        res_text: "{{ res.data | default(' ') | string }}"
        gas_value:
          '{{ (res_text | regex_findall(''[0-9]+(?:\.[0-9]+)?'') | first |
          default(''0'')) | float(0) | round(4) }}'
        current_value: "{{ states('sensor.gas_meter_2') | float(0) }}"
        delta: "{{ (gas_value - current_value) | round(4) }}"
    - action: input_number.set_value
      metadata: {}
      data:
        value: "{{ gas_value | float }}"
      target:
        entity_id: input_number.gas_meter_2
    - action: homeassistant.update_entity
      metadata: {}
      target:
        entity_id:
          - sensor.gas_meter_2
          - sensor.gas_meter_monthly
    - action: persistent_notification.create
      data:
        title: âœ… ê°€ìŠ¤ ê²€ì¹¨(ë‹¨ì¼ í”„ë¡¬í”„íŠ¸) ê¸°ë¡ë¨
        message: '{{ now().strftime(''%H:%M:%S'') }} | ì‘ë‹µ: "{{ res_text }}"

          ì ìš©ê°’: {{ gas_value }} mÂ³ (Î”={{ delta }} mÂ³, ê²€ì¦ ìƒëµ)'
  mode: single
- id: electricity_energy_prev2_monthly_update
  alias: ì „ê¸° ì „ì „ì›” ì‚¬ìš©ëŸ‰ ì—…ë°ì´íŠ¸
  description: ì „ì›” ì „ê¸° ì‚¬ìš©ëŸ‰ ë³€ê²½ ì‹œ ì „ì „ì›” ê°’ì„ ì—…ë°ì´íŠ¸
  trigger:
    - trigger: state
      entity_id:
        - sensor.electricity_energy_prev_monthly
  condition:
    - condition: template
      value_template:
        "{{ trigger.to_state.state|float(0) > 0 and trigger.from_state.state|float(0)
        > 0 }}"
  action:
    - action: input_number.set_value
      data:
        value: "{{ trigger.from_state.state }}"
      target:
        entity_id: input_number.electricity_energy_prev2_monthly
  mode: single
- id: "1761134823433"
  alias: ì‹œì‘ ì‹œ í†µí•©êµ¬ì„±ìš”ì†Œ ìƒˆë¡œê³ ì¹¨
  description:
    Home Assistantê°€ ì‹œì‘ë  ë•Œ ì¼ë¶€ í†µí•©êµ¬ì„±ìš”ì†Œê°€ ì˜¬ë°”ë¥´ê²Œ ì´ˆê¸°í™”ë˜ì§€ ì•ŠëŠ” ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ê´€ë ¨ êµ¬ì„± í•­ëª©ì„
    ë‹¤ì‹œ ë¡œë“œí•©ë‹ˆë‹¤.
  trigger:
    - trigger: homeassistant
      event: start
  condition: []
  action:
    - action: homeassistant.reload_config_entry
      target:
        entity_id:
          - sensor.mart_l_goyangjeom
          - sensor.mart_e_3047
          - sensor.mart_e_1096
          - sensor.mart_e_2012
          - weather.wn_jib
          - sensor.wn_jib_weather_briefing
          - sensor.wn_jib_next_day_short_comment
          - sensor.wn_jib_day_short_comment
          - sensor.wn_jib_day_condition
          - sensor.wn_jib_night_condition
          - sensor.wn_jib_current_condition
          - weather.forecast_jib
          - image.windy_webcams_1701618298
          - image.windy_webcams_1689176350
          - sensor.sihas_energy_monitor_power
      data: {}
  mode: single

- id: "1761546151051"
  alias: InfluxDB ê²©ì£¼ ë°±ì—… (ì¼ìš”ì¼ 03:00)
  description: ê²©ì£¼ ì¼ìš”ì¼ ìƒˆë²½ 3ì‹œì— InfluxDB ìë™ ë°±ì—… (ì§ìˆ˜ ì£¼ì°¨)
  trigger:
    - at: 03:00:00
      trigger: time
  condition:
    - condition: time
      weekday:
        - sun
    - condition: template
      value_template: "{{ now().isocalendar()[1] % 2 == 0 }}"
  action:
    - data: {}
      action: shell_command.influxdb_backup
  mode: single

- id: fall_alert_latch_on
  alias: ë‚™ìƒ ê°ì§€ ë˜ì¹˜ ON
  trigger:
    - trigger: state
      entity_id: binary_sensor.fall_detected
      from: "off"
      to: "on"
  action:
    - action: input_boolean.turn_on
      target:
        entity_id: input_boolean.fall_alert_active

    - action: input_datetime.set_datetime
      target:
        entity_id: input_datetime.fall_last_time
      data:
        date: "{{ now().strftime('%Y-%m-%d') }}"
        time: "{{ now().strftime('%H:%M:%S') }}"
  mode: single
- id: fall_detected_alert_full
  alias: "ğŸš¨ ë‚™ìƒ ê°ì§€: ë‹¤ì¤‘ í‘¸ì‹œ + ë‹¤í¬í…Œë§ˆ íŒì—…"
  trigger:
    - trigger: state
      entity_id: binary_sensor.fall_detected
      to: "on"

  action:
    # ğŸ“± ë‹¤ì¤‘ ê¸°ê¸°ë¡œ í¬ë¦¬í‹°ì»¬ í‘¸ì‹œ ì „ì†¡ (ğŸ”Š ì†Œë¦¬ ì•Œë¦¼ í¬í•¨)
    - action: notify.group_fall_alert_devices
      data:
        title: "ğŸš¨ ë‚™ìƒ ê°ì§€"
        message: "ì¦‰ì‹œ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”."
        data:
          push:
            sound:
              name: default
              critical: 1
              volume: 1.0
          channel: alarm_stream_max
          ttl: 0
          priority: high
          importance: high
          persistent: true
          url: /lovelace/home
          actions:
            - action: ACK_FALL
              title: "í™•ì¸"

    # ğŸ’¬ ë¸Œë¼ìš°ì € íŒì—… (í…Œë‘ë¦¬ ë°˜ì§ì„ ë²„ì „)
    - action: browser_mod.popup
      data:
        title: "ğŸš¨ ë‚™ìƒ ì•Œë¦¼"
        dismissable: true
        large: true
        content: |
          <style>
            /* íŒì—… ì „ì²´ ë‹¤í¬í…Œë§ˆ + ë°˜ì§ì´ëŠ” í…Œë‘ë¦¬ */
            ha-dialog {
              --mdc-dialog-surface-color: rgba(25, 25, 25, 0.95);
              border: 3px solid rgba(255, 0, 0, 0.85);
              border-radius: 18px;
              animation: border-flash 1.5s infinite;
              box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
            }

            /* ë¶‰ì€ í…Œë‘ë¦¬ ë°˜ì§ì„ */
            @keyframes border-flash {
              0%, 100% {
                border-color: rgba(255, 0, 0, 0.6);
                box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
              }
              50% {
                border-color: rgba(255, 50, 50, 1);
                box-shadow: 0 0 25px rgba(255, 0, 0, 0.9);
              }
            }

            /* ì œëª© í…ìŠ¤íŠ¸ */
            h1 {
              text-align: center;
              color: #ffffff;
              font-size: 2em;
              margin: 0 0 14px 0;
              text-shadow: 0 0 8px rgba(255, 80, 80, 0.9);
            }

            /* ë¶€ê°€ ë¬¸êµ¬ */
            p {
              text-align: center;
              color: #cccccc;
              font-size: 1.1em;
              margin: 0;
            }
          </style>

          <h1>ğŸš¨ ë‚™ìƒì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤!</h1>
          <p>ì¦‰ì‹œ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</p>
        deviceID:
          - this
  mode: restart
