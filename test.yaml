# Paste this into a single "Manual" card in the UI editor
# Requires these resources installed/loaded: button-card, card-mod, bubble-card, paper-buttons-row, local-conditional-card, gap-card
# Uses core energy cards: energy-date-selection, energy-usage-graph, energy-sources-table

type: vertical-stack
cards:
  - type: custom:bubble-card
    card_type: pop-up
    name: 에너지
    icon: mdi:power-plug
    state: null
    hash: '#strom'
    is_sidebar_hidden: true
    styles: >-
      .bubble-pop-up-container {
        --vertical-stack-card-gap: 0px!important;
      }
      #header-container > div > div { background: var(--popupBG)!important; }
      #header-container > button { background: none; }
      .icon-container { background-color: var(--gray800)!important; }
      .icon-container > ha-icon { color: var(--gray000)!important; opacity: 1!important }
      .bubble-icon { --mdc-icon-size: 24px !important; }
    bg_blur: '5'
    shadow_opacity: '20'
    bg_opacity: '98'
    margin_top_mobile: 50px
    margin_top_desktop: 50px
    card_layout: large

  - type: custom:gap-card
    height: 0

  - type: vertical-stack
    cards:
      # 탭 1: 사용량
      - type: custom:local-conditional-card
        id: forbruk
        default: show
        card:
          type: vertical-stack
          cards:
            - type: custom:paper-buttons-row
              styles:
                justify-content: center
                margin: 0 auto 6px auto
                width: max-content
                background-color: var(--popupBG)
                border: 4px solid var(--popupBG)
                border-radius: 28px
              buttons:
                - layout: name
                  name: 사용량
                  ripple: none
                  tap_action:
                    action: fire-dom-event
                    local_conditional_card:
                      action: set
                      ids:
                        - priser: hide
                        - forbruk: show
                  styles:
                    name:
                      padding: 0 22px
                      color: var(--black)
                    button:
                      display: flex
                      height: 24px
                      background: var(--active-small)
                      border-radius: 24px
                      color: var(--white)
                - layout: name
                  name: 요금
                  ripple: none
                  tap_action:
                    action: fire-dom-event
                    local_conditional_card:
                      action: set
                      ids:
                        - priser: show
                        - forbruk: hide
                  styles:
                    name:
                      padding: 0 22px
                      color: var(--gray800)
                    button:
                      display: flex
                      height: 24px
                      background-color: none
                      border-radius: 24px
                      color: var(--white)

            - type: custom:gap-card
              height: 6

            - type: grid
              square: false
              columns: 2
              cards:
                # sensor_big (인라인)
                - type: custom:button-card
                  name: 현재 전력
                  show_label: true
                  icon: mdi:home-lightning-bolt
                  label: |
                    [[[ 
                      const s = states['sensor.sihas_energy_monitor_power'] || states['sensor.total_power_consumption'];
                      let raw = s?.state;
                      if (!raw || raw === 'unknown' || raw === 'unavailable') raw = '0';
                      const value = Number(raw) || 0;
                      const formatted = value.toLocaleString('ko-KR');
                      return `${formatted} <span style="font-size:14px">W</span>`;
                    ]]]
                  styles:
                    card:
                      - padding: 20px
                      - height: 180px
                      - background: var(--popupBG)
                    grid:
                      - grid-template-areas: '"i" "l" "n"'
                    img_cell:
                      - justify-self: end
                      - align-self: start
                      - background: rgba(var(--highlight))
                      - padding: 14px
                      - border-radius: 50%
                      - margin: '-16px -16px 0 0'
                      - width: 30px
                      - height: 30px
                    icon:
                      - width: 30px
                      - height: 30px
                      - color: var(--gray800)
                    label:
                      - justify-self: start
                      - font-size: 2em
                      - font-weight: 300
                      - color: var(--gray800)
                    name:
                      - justify-self: start
                      - font-size: 14px
                      - color: var(--gray800)
                      - opacity: '0.7'

                # sensor_big_2columns (인라인)
                - type: custom:button-card
                  name: 이번 달 사용량
                  show_label: true
                  icon: mdi:lightning-bolt
                  custom_fields:
                    state: |
                      [[[  return (states['sensor.electricity_energy_monthly']?.state || '0') + ' kWh' ]]]
                  label: |
                    [[[  return '누적 계량: ' + (states['sensor.sihas_energy_monitor_energy']?.state || '0') + ' kWh' ]]]
                  styles:
                    card:
                      - padding: 20px
                      - height: 180px
                      - background: var(--popupBG)
                    grid:
                      - grid-template-areas: '"i i" "l state" "n n"'
                    img_cell:
                      - justify-self: end
                      - align-self: start
                      - background: rgba(var(--highlight))
                      - padding: 14px
                      - border-radius: 50%
                      - margin: '-16px -16px 0 0'
                      - width: 30px
                      - height: 30px
                    icon:
                      - width: 30px
                      - height: 30px
                      - color: var(--gray800)
                    label:
                      - justify-self: start
                      - font-size: 2em
                      - font-weight: 300
                      - color: var(--gray800)
                    name:
                      - justify-self: start
                      - font-size: 14px
                      - color: var(--gray800)
                      - opacity: '0.7'
                    custom_fields:
                      state:
                        - align-self: end
                        - font-size: 14px
                        - color: var(--gray800)
                        - opacity: '0.7'
                        - margin-bottom: 5px

            # sensor_small (누적 사용량)
            - type: custom:button-card
              entity: sensor.sihas_energy_monitor_energy
              name: 누적 사용량 (계량)
              show_label: true
              icon: mdi:gauge
              label: |
                [[[ return (entity?.state || '0') + ' kWh'; ]]]
              styles:
                grid:
                  - grid-template-columns: 76px 1fr
                  - grid-template-areas: '"i l" "i n"'
                icon:
                  - width: 30px
                  - color: var(--gray800)
                img_cell:
                  - justify-self: start
                  - width: 30px
                  - height: 30px
                  - background: rgba(var(--highlight))
                  - padding: 14px
                  - border-radius: 50%
                label:
                  - justify-self: start
                  - font-size: 16px
                  - padding-top: 4px
                  - font-weight: 500
                  - color: var(--gray800)
                card:
                  - height: 66px
                  - border-radius: 75px
                  - padding: 4px 20px 4px 4px
                  - background: var(--popupBG)
                  - margin: 12px 0 0 0
                name:
                  - justify-self: start
                  - font-size: 14px
                  - color: var(--gray800)
                  - opacity: 0.7
                  - padding-bottom: 7px

            - type: energy-date-selection
              card_mod:
                style: >
                  ha-card {background: none;}
                  ha-card > div > hui-energy-period-selector $ div > .label {font-size:10px!important }

            - type: energy-usage-graph
              card_mod:
                style: |
                  ha-card {background: var(--popupBG);}

            - type: custom:gap-card
              height: 12

            - type: energy-sources-table
              card_mod:
                style: >
                  ha-card { background: var(--popupBG)!important; }
                  .mdc-data-table { background: var(--popupBG)!important; }
                  .mdc-data-table__row {height: 32px!important;}
                  .mdc-data-table__table-container {padding-bottom: 12px!important;}
                  .mdc-data-table__table { white-space: unset!important; }
                  .mdc-data-table__cell, .mdc-data-table__header-cell {border: none!important;}
                  .mdc-data-table .mdc-data-table__header-cell {background:var(--popupBG)!important;border-bottom:1px solid var(--popupBG)!important}
                  .bullet {width: 16px!important;border-radius: 24px!important;border-width: 0!important;}

            - type: custom:gap-card
              height: 30

      # 탭 2: 요금
      - type: custom:local-conditional-card
        id: priser
        default: hide
        card:
          type: vertical-stack
          cards:
            - type: custom:paper-buttons-row
              styles:
                justify-content: center
                margin: 0 auto 6px auto
                width: max-content
                background-color: var(--popupBG)
                border: 4px solid var(--popupBG)
                border-radius: 28px
              buttons:
                - layout: name
                  name: 사용량
                  ripple: none
                  tap_action:
                    action: fire-dom-event
                    local_conditional_card:
                      action: set
                      ids:
                        - priser: hide
                        - forbruk: show
                  styles:
                    name:
                      padding: 0 22px
                      color: var(--gray800)
                    button:
                      display: flex
                      height: 24px
                      background-color: none
                      border-radius: 24px
                      color: var(--white)
                - layout: name
                  name: 요금
                  ripple: none
                  tap_action:
                    action: fire-dom-event
                    local_conditional_card:
                      action: set
                      ids:
                        - priser: show
                        - forbruk: hide
                  styles:
                    name:
                      padding: 0 22px
                      color: var(--black)
                    button:
                      display: flex
                      height: 24px
                      background: var(--active-small)
                      border-radius: 24px
                      color: var(--white)

            - type: custom:gap-card
              height: 6

            - type: grid
              square: false
              columns: 2
              cards:
                # sensor_big (인라인)
                - type: custom:button-card
                  name: 현재 사용요금
                  show_label: true
                  icon: mdi:receipt-text
                  label: |
                    [[[ 
                      let raw = states['sensor.jeongiyogeum_gyesan_kwhto_won']?.state;
                      if (!raw || raw === 'unknown' || raw === 'unavailable') raw = '0';
                      const value = Number(raw) || 0;
                      const formatted = value.toLocaleString('ko-KR');
                      return `${formatted} <span style="font-size:14px">원</span>`;
                    ]]]
                  styles:
                    card:
                      - padding: 20px
                      - height: 180px
                      - background: var(--popupBG)
                    grid:
                      - grid-template-areas: '"i" "l" "n"'
                    img_cell:
                      - justify-self: end
                      - align-self: start
                      - background: rgba(var(--highlight))
                      - padding: 14px
                      - border-radius: 50%
                      - margin: '-16px -16px 0 0'
                      - width: 30px
                      - height: 30px
                    icon:
                      - width: 30px
                      - height: 30px
                      - color: var(--gray800)
                    label:
                      - justify-self: start
                      - font-size: 2em
                      - font-weight: 300
                      - color: var(--gray800)
                    name:
                      - justify-self: start
                      - font-size: 14px
                      - color: var(--gray800)
                      - opacity: '0.7'

                # sensor_big (인라인)
                - type: custom:button-card
                  name: 예상 요금
                  show_label: true
                  icon: mdi:calculator
                  label: |
                    [[[ 
                      let raw = states['sensor.jeongiyogeum_gyesan_kwhto_forecast_won']?.state;
                      if (!raw || raw === 'unknown' || raw === 'unavailable') raw = '0';
                      const value = Number(raw) || 0;
                      const formatted = value.toLocaleString('ko-KR');
                      return `${formatted} <span style="font-size:14px">원</span>`;
                    ]]]
                  styles:
                    card:
                      - padding: 20px
                      - height: 180px
                      - background: var(--popupBG)
                    grid:
                      - grid-template-areas: '"i" "l" "n"'
                    img_cell:
                      - justify-self: end
                      - align-self: start
                      - background: rgba(var(--highlight))
                      - padding: 14px
                      - border-radius: 50%
                      - margin: '-16px -16px 0 0'
                      - width: 30px
                      - height: 30px
                    icon:
                      - width: 30px
                      - height: 30px
                      - color: var(--gray800)
                    label:
                      - justify-self: start
                      - font-size: 2em
                      - font-weight: 300
                      - color: var(--gray800)
                    name:
                      - justify-self: start
                      - font-size: 14px
                      - color: var(--gray800)
                      - opacity: '0.7'

            # sensor_small (월 사용량)
            - type: custom:button-card
              name: 현재 사용량 (월)
              show_label: true
              icon: mdi:counter
              label: |
                [[[ let raw = states['sensor.jeongiyogeum_gyesan_kwhto_kwh']?.state || '0'; return `${raw} kWh`; ]]]
              styles:
                grid:
                  - grid-template-columns: 76px 1fr
                  - grid-template-areas: '"i l" "i n"'
                icon:
                  - width: 30px
                  - color: var(--gray800)
                img_cell:
                  - justify-self: start
                  - width: 30px
                  - height: 30px
                  - background: rgba(var(--highlight))
                  - padding: 14px
                  - border-radius: 50%
                label:
                  - justify-self: start
                  - font-size: 16px
                  - padding-top: 4px
                  - font-weight: 500
                  - color: var(--gray800)
                card:
                  - height: 66px
                  - border-radius: 75px
                  - padding: 4px 20px 4px 4px
                  - background: var(--popupBG)
                  - margin: 12px 0 0 0
                name:
                  - justify-self: start
                  - font-size: 14px
                  - color: var(--gray800)
                  - opacity: 0.7
                  - padding-bottom: 7px

            - type: custom:button-card
              name: 예상 사용량 (월)
              show_label: true
              icon: mdi:counter
              label: |
                [[[ let raw = states['sensor.jeongiyogeum_gyesan_kwhto_forecast']?.state || '0'; return `${raw} kWh`; ]]]
              styles:
                grid:
                  - grid-template-columns: 76px 1fr
                  - grid-template-areas: '"i l" "i n"'
                icon:
                  - width: 30px
                  - color: var(--gray800)
                img_cell:
                  - justify-self: start
                  - width: 30px
                  - height: 30px
                  - background: rgba(var(--highlight))
                  - padding: 14px
                  - border-radius: 50%
                label:
                  - justify-self: start
                  - font-size: 16px
                  - padding-top: 4px
                  - font-weight: 500
                  - color: var(--gray800)
                card:
                  - height: 66px
                  - border-radius: 75px
                  - padding: 4px 20px 4px 4px
                  - background: var(--popupBG)
                name:
                  - justify-self: start
                  - font-size: 14px
                  - color: var(--gray800)
                  - opacity: 0.7
                  - padding-bottom: 7px

            - type: custom:gap-card
              height: 30
